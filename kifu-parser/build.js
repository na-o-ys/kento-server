!function(t){function e(o){if(r[o])return r[o].exports;var n=r[o]={exports:{},id:o,loaded:!1};return t[o].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){"use strict";function o(t){return t&&t.__esModule?t:{"default":t}}var n=r(3),i=o(n);window.parse=function(t){return i["default"].parse(t).kifu}},function(t,e){/** @license
	 * Shogi.js
	 * Copyright (c) 2014 na2hiro (https://github.com/na2hiro)
	 * This software is released under the MIT License.
	 * http://opensource.org/licenses/mit-license.php
	 */
!function(t){t[t.Black=0]="Black",t[t.White=1]="White"}(e.Color||(e.Color={}));var r=e.Color,o=function(){function t(t){this.initialize(t)}return t.prototype.initialize=function(e){if(void 0===e&&(e={preset:"HIRATE"}),this.board=[],"OTHER"!=e.preset){for(var o=0;9>o;o++){this.board[o]=[];for(var i=0;9>i;i++){var u=t.preset[e.preset].board[i].slice(24-3*o,24-3*o+3);this.board[o][i]=" * "==u?null:new n(u)}}this.turn=t.preset[e.preset].turn,this.hands=[[],[]]}else{for(var o=0;9>o;o++){this.board[o]=[];for(var i=0;9>i;i++){var a=e.data.board[o][i];this.board[o][i]=a.kind?new n((a.color==r.Black?"+":"-")+a.kind):null}}this.turn=e.data.color,this.hands=[[],[]];for(var s=0;2>s;s++)for(var c in e.data.hands[s])for(var u=(0==s?"+":"-")+c,o=0;o<e.data.hands[s][c];o++)this.hands[s].push(new n(u))}this.flagEditMode=!1},t.prototype.editMode=function(t){this.flagEditMode=t},t.prototype.move=function(t,e,r,o,n){void 0===n&&(n=!1);var i=this.get(t,e);if(null==i)throw"no piece found at "+t+", "+e;if(this.checkTurn(i.color),!this.flagEditMode&&!this.getMovesFrom(t,e).some(function(t){return t.to.x==r&&t.to.y==o}))throw"cannot move from "+t+", "+e+" to "+r+", "+o;null!=this.get(r,o)&&this.capture(r,o),n&&i.promote(),this.set(r,o,i),this.set(t,e,null),this.nextTurn()},t.prototype.unmove=function(t,e,r,o,i,u){void 0===i&&(i=!1);var a=this.get(r,o);if(null==a)throw"no piece found at "+r+", "+o;this.checkTurn(n.oppositeColor(a.color));var s;u&&(s=this.popFromHand(n.unpromote(u),a.color),s.inverse());var c=this.flagEditMode;this.editMode(!0),this.move(r,o,t,e),i&&a.unpromote(),u&&(n.isPromoted(u)&&s.promote(),this.set(r,o,s)),this.editMode(c),this.prevTurn()},t.prototype.drop=function(t,e,r,o){if(void 0===o&&(o=this.turn),this.checkTurn(o),null!=this.get(t,e))throw"there is a piece at "+t+", "+e;var n=this.popFromHand(r,o);this.set(t,e,n),this.nextTurn()},t.prototype.undrop=function(t,e){var r=this.get(t,e);if(null==r)throw"there is no piece at "+t+", "+e;this.checkTurn(n.oppositeColor(r.color)),this.pushToHand(r),this.set(t,e,null),this.prevTurn()},t.prototype.toCSAString=function(){for(var t=[],e=0;9>e;e++){for(var o="P"+(e+1),n=8;n>=0;n--){var i=this.board[n][e];o+=null==i?" * ":i.toCSAString()}t.push(o)}for(var u=0;2>u;u++){for(var o="P"+"+-"[u],a=0;a<this.hands[u].length;a++)o+="00"+this.hands[u][a].kind;t.push(o)}return t.push(this.turn==r.Black?"+":"-"),t.join("\n")},t.prototype.getMovesFrom=function(t,e){var o=function(t,e,r){if(1>t||t>9||1>e||e>9)return!1;var o=this.get(t,e);return null==o||o.color!=r}.bind(this),i=function(t,e,r){var o=this.get(t,e);return null!=o&&o.color!=r}.bind(this),u=this.get(t,e);if(null==u)return[];var a=n.getMoveDef(u.kind),s=[],c={x:t,y:e};if(a.just)for(var l=0;l<a.just.length;l++){var f=a.just[l];u.color==r.White&&(f[0]*=-1,f[1]*=-1);var h={x:c.x+f[0],y:c.y+f[1]};o(h.x,h.y,u.color)&&s.push({from:c,to:h})}if(a.fly)for(var l=0;l<a.fly.length;l++){var f=a.fly[l];u.color==r.White&&(f[0]*=-1,f[1]*=-1);for(var h={x:c.x+f[0],y:c.y+f[1]};o(h.x,h.y,u.color)&&(s.push({from:c,to:{x:h.x,y:h.y}}),!i(h.x,h.y,u.color));)h.x+=f[0],h.y+=f[1]}return s},t.prototype.getDropsBy=function(t){for(var e=[],r=[],o=1;9>=o;o++)for(var n=1;9>=n;n++)null==this.get(o,n)&&r.push({x:o,y:n});for(var i={},o=0;o<this.hands[t].length;o++){var u=this.hands[t][o].kind;if(!i[u]){i[u]=!0;for(var n=0;n<r.length;n++)e.push({to:r[n],color:t,kind:u})}}return e},t.prototype.getMovesTo=function(t,e,r,o){void 0===o&&(o=this.turn);for(var n={x:t,y:e},i=[],u=1;9>=u;u++)for(var a=1;9>=a;a++){var s=this.get(u,a);if(s&&s.kind==r&&s.color==o){var c=this.getMovesFrom(u,a);c.some(function(r){return r.to.x==t&&r.to.y==e})&&i.push({from:{x:u,y:a},to:n})}}return i},t.prototype.get=function(t,e){return this.board[t-1][e-1]},t.prototype.getHandsSummary=function(t){for(var e={FU:0,KY:0,KE:0,GI:0,KI:0,KA:0,HI:0},r=0;r<this.hands[t].length;r++)e[this.hands[t][r].kind]++;return e},t.prototype.captureByColor=function(t,e,r){if(!this.flagEditMode)throw"cannot edit board without editMode";var o=this.get(t,e);this.set(t,e,null),o.unpromote(),o.color!=r&&o.inverse(),this.pushToHand(o)},t.prototype.flip=function(t,e){if(!this.flagEditMode)throw"cannot edit board without editMode";var r=this.get(t,e);return r?(n.isPromoted(r.kind)?(r.unpromote(),r.inverse()):n.canPromote(r.kind)?r.promote():r.inverse(),!0):!1},t.prototype.setTurn=function(t){if(!this.flagEditMode)throw"cannot set turn without editMode";this.turn=t},t.prototype.set=function(t,e,r){this.board[t-1][e-1]=r},t.prototype.capture=function(t,e){var r=this.get(t,e);this.set(t,e,null),r.unpromote(),r.inverse(),this.pushToHand(r)},t.prototype.pushToHand=function(t){this.hands[t.color].push(t)},t.prototype.popFromHand=function(t,e){for(var r=this.hands[e],o=0;o<r.length;o++)if(r[o].kind==t){var n=r[o];return r.splice(o,1),n}throw e+" has no "+t},t.prototype.nextTurn=function(){this.flagEditMode||(this.turn=this.turn==r.Black?r.White:r.Black)},t.prototype.prevTurn=function(){this.flagEditMode||this.nextTurn()},t.prototype.checkTurn=function(t){if(!this.flagEditMode&&t!=this.turn)throw"cannot move opposite piece"},t.preset={HIRATE:{board:["-KY-KE-GI-KI-OU-KI-GI-KE-KY"," * -HI *  *  *  *  * -KA * ","-FU-FU-FU-FU-FU-FU-FU-FU-FU"," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * ","+FU+FU+FU+FU+FU+FU+FU+FU+FU"," * +KA *  *  *  *  * +HI * ","+KY+KE+GI+KI+OU+KI+GI+KE+KY"],turn:r.Black},KY:{board:["-KY-KE-GI-KI-OU-KI-GI-KE * "," * -HI *  *  *  *  * -KA * ","-FU-FU-FU-FU-FU-FU-FU-FU-FU"," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * ","+FU+FU+FU+FU+FU+FU+FU+FU+FU"," * +KA *  *  *  *  * +HI * ","+KY+KE+GI+KI+OU+KI+GI+KE+KY"],turn:r.White},KY_R:{board:[" * -KE-GI-KI-OU-KI-GI-KE-KY"," * -HI *  *  *  *  * -KA * ","-FU-FU-FU-FU-FU-FU-FU-FU-FU"," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * ","+FU+FU+FU+FU+FU+FU+FU+FU+FU"," * +KA *  *  *  *  * +HI * ","+KY+KE+GI+KI+OU+KI+GI+KE+KY"],turn:r.White},KA:{board:["-KY-KE-GI-KI-OU-KI-GI-KE-KY"," * -HI *  *  *  *  *  *  * ","-FU-FU-FU-FU-FU-FU-FU-FU-FU"," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * ","+FU+FU+FU+FU+FU+FU+FU+FU+FU"," * +KA *  *  *  *  * +HI * ","+KY+KE+GI+KI+OU+KI+GI+KE+KY"],turn:r.White},HI:{board:["-KY-KE-GI-KI-OU-KI-GI-KE-KY"," *  *  *  *  *  *  * -KA * ","-FU-FU-FU-FU-FU-FU-FU-FU-FU"," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * ","+FU+FU+FU+FU+FU+FU+FU+FU+FU"," * +KA *  *  *  *  * +HI * ","+KY+KE+GI+KI+OU+KI+GI+KE+KY"],turn:r.White},HIKY:{board:["-KY-KE-GI-KI-OU-KI-GI-KE * "," *  *  *  *  *  *  * -KA * ","-FU-FU-FU-FU-FU-FU-FU-FU-FU"," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * ","+FU+FU+FU+FU+FU+FU+FU+FU+FU"," * +KA *  *  *  *  * +HI * ","+KY+KE+GI+KI+OU+KI+GI+KE+KY"],turn:r.White},2:{board:["-KY-KE-GI-KI-OU-KI-GI-KE-KY"," *  *  *  *  *  *  *  *  * ","-FU-FU-FU-FU-FU-FU-FU-FU-FU"," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * ","+FU+FU+FU+FU+FU+FU+FU+FU+FU"," * +KA *  *  *  *  * +HI * ","+KY+KE+GI+KI+OU+KI+GI+KE+KY"],turn:r.White},3:{board:["-KY-KE-GI-KI-OU-KI-GI-KE * "," *  *  *  *  *  *  *  *  * ","-FU-FU-FU-FU-FU-FU-FU-FU-FU"," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * ","+FU+FU+FU+FU+FU+FU+FU+FU+FU"," * +KA *  *  *  *  * +HI * ","+KY+KE+GI+KI+OU+KI+GI+KE+KY"],turn:r.White},4:{board:[" * -KE-GI-KI-OU-KI-GI-KE * "," *  *  *  *  *  *  *  *  * ","-FU-FU-FU-FU-FU-FU-FU-FU-FU"," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * ","+FU+FU+FU+FU+FU+FU+FU+FU+FU"," * +KA *  *  *  *  * +HI * ","+KY+KE+GI+KI+OU+KI+GI+KE+KY"],turn:r.White},5:{board:[" *  * -GI-KI-OU-KI-GI-KE * "," *  *  *  *  *  *  *  *  * ","-FU-FU-FU-FU-FU-FU-FU-FU-FU"," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * ","+FU+FU+FU+FU+FU+FU+FU+FU+FU"," * +KA *  *  *  *  * +HI * ","+KY+KE+GI+KI+OU+KI+GI+KE+KY"],turn:r.White},"5_L":{board:[" * -KE-GI-KI-OU-KI-GI *  * "," *  *  *  *  *  *  *  *  * ","-FU-FU-FU-FU-FU-FU-FU-FU-FU"," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * ","+FU+FU+FU+FU+FU+FU+FU+FU+FU"," * +KA *  *  *  *  * +HI * ","+KY+KE+GI+KI+OU+KI+GI+KE+KY"],turn:r.White},6:{board:[" *  * -GI-KI-OU-KI-GI *  * "," *  *  *  *  *  *  *  *  * ","-FU-FU-FU-FU-FU-FU-FU-FU-FU"," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * ","+FU+FU+FU+FU+FU+FU+FU+FU+FU"," * +KA *  *  *  *  * +HI * ","+KY+KE+GI+KI+OU+KI+GI+KE+KY"],turn:r.White},8:{board:[" *  *  * -KI-OU-KI *  *  * "," *  *  *  *  *  *  *  *  * ","-FU-FU-FU-FU-FU-FU-FU-FU-FU"," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * ","+FU+FU+FU+FU+FU+FU+FU+FU+FU"," * +KA *  *  *  *  * +HI * ","+KY+KE+GI+KI+OU+KI+GI+KE+KY"],turn:r.White},10:{board:[" *  *  *  * -OU *  *  *  * "," *  *  *  *  *  *  *  *  * ","-FU-FU-FU-FU-FU-FU-FU-FU-FU"," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * "," *  *  *  *  *  *  *  *  * ","+FU+FU+FU+FU+FU+FU+FU+FU+FU"," * +KA *  *  *  *  * +HI * ","+KY+KE+GI+KI+OU+KI+GI+KE+KY"],turn:r.White}},t}();e.Shogi=o;var n=function(){function t(t){this.color="+"==t.slice(0,1)?r.Black:r.White,this.kind=t.slice(1)}return t.prototype.promote=function(){this.kind=t.promote(this.kind)},t.prototype.unpromote=function(){this.kind=t.unpromote(this.kind)},t.prototype.inverse=function(){this.color=this.color==r.Black?r.White:r.Black},t.prototype.toCSAString=function(){return(this.color==r.Black?"+":"-")+this.kind},t.promote=function(t){return{FU:"TO",KY:"NY",KE:"NK",GI:"NG",KA:"UM",HI:"RY"}[t]||t},t.unpromote=function(t){return{TO:"FU",NY:"KY",NK:"KE",NG:"GI",KI:"KI",UM:"KA",RY:"HI",OU:"OU"}[t]||t},t.canPromote=function(e){return t.promote(e)!=e},t.getMoveDef=function(t){switch(t){case"FU":return{just:[[0,-1]]};case"KY":return{fly:[[0,-1]]};case"KE":return{just:[[-1,-2],[1,-2]]};case"GI":return{just:[[-1,-1],[0,-1],[1,-1],[-1,1],[1,1]]};case"KI":case"TO":case"NY":case"NK":case"NG":return{just:[[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[0,1]]};case"KA":return{fly:[[-1,-1],[1,-1],[-1,1],[1,1]]};case"HI":return{fly:[[0,-1],[-1,0],[1,0],[0,1]]};case"OU":return{just:[[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]]};case"UM":return{fly:[[-1,-1],[1,-1],[-1,1],[1,1]],just:[[0,-1],[-1,0],[1,0],[0,1]]};case"RY":return{fly:[[0,-1],[-1,0],[1,0],[0,1]],just:[[-1,-1],[1,-1],[-1,1],[1,1]]}}},t.isPromoted=function(t){return["TO","NY","NK","NG","UM","RY"].indexOf(t)>=0},t.oppositeColor=function(t){return t==r.Black?r.White:r.Black},t}();e.Piece=n},function(t,e){t.exports=function(){function t(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}function e(t,e,r,o,n,i){this.message=t,this.expected=e,this.found=r,this.offset=o,this.line=n,this.column=i,this.name="SyntaxError"}function r(t){function r(e){function r(e,r,o){var n,i;for(n=r;o>n;n++)i=t.charAt(n),"\n"===i?(e.seenCR||e.line++,e.column=1,e.seenCR=!1):"\r"===i||"\u2028"===i||"\u2029"===i?(e.line++,e.column=1,e.seenCR=!0):(e.column++,e.seenCR=!1)}return pe!==e&&(pe>e&&(pe=0,de={line:1,column:1,seenCR:!1}),r(de,pe,e),pe=e),de}function o(t){ve>fe||(fe>ve&&(ve=fe,Fe=[]),Fe.push(t))}function n(o,n,i){function u(t){var e=1;for(t.sort(function(t,e){return t.description<e.description?-1:t.description>e.description?1:0});e<t.length;)t[e-1]===t[e]?t.splice(e,1):e++}function a(t,e){function r(t){function e(t){return t.charCodeAt(0).toString(16).toUpperCase()}return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(t){return"\\x0"+e(t)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(t){return"\\x"+e(t)}).replace(/[\u0180-\u0FFF]/g,function(t){return"\\u0"+e(t)}).replace(/[\u1080-\uFFFF]/g,function(t){return"\\u"+e(t)})}var o,n,i,u=new Array(t.length);for(i=0;i<t.length;i++)u[i]=t[i].description;return o=t.length>1?u.slice(0,-1).join(", ")+" or "+u[t.length-1]:u[0],n=e?'"'+r(e)+'"':"end of input","Expected "+o+" but "+n+" found."}var s=r(i),c=i<t.length?t.charAt(i):null;return null!==n&&u(n),new e(null!==o?o:a(n,c),n,c,i,s.line,s.column)}function i(){var t;return t=u(),t===R&&(t=f()),t}function u(){var t,e,r,o,n;return t=fe,e=a(),e!==R?(r=s(),r===R&&(r=W),r!==R?(o=p(),o!==R?(n=y(),n===R&&(n=W),n!==R?(he=t,e=j(r,o,n),t=e):(fe=t,t=S)):(fe=t,t=S)):(fe=t,t=S)):(fe=t,t=S),t}function a(){var e,r,n,i;for(e=fe,r=[],n=C();n!==R;)r.push(n),n=C();return r!==R?(t.substr(fe,4)===_?(n=_,fe+=4):(n=R,0===Ue&&o(P)),n!==R?(i=O(),i!==R?(r=[r,n,i],e=r):(fe=e,e=S)):(fe=e,e=S)):(fe=e,e=S),e}function s(){var t,e,r;return t=fe,e=h(),e===R&&(e=W),e!==R?(r=c(),r!==R?(he=t,e=V(e,r),t=e):(fe=t,t=S)):(fe=t,t=S),t}function c(){var t,e,r;for(t=fe,e=[],r=l();r!==R;)e.push(r),r=l();return e!==R&&(he=t,e=z(e)),t=e}function l(){var e,r,n,i,u,a,s;for(e=fe,r=[],n=C();n!==R;)r.push(n),n=C();if(r!==R)if(36===t.charCodeAt(fe)?(n=J,fe++):(n=R,0===Ue&&o(Z)),n!==R){if(i=[],$.test(t.charAt(fe))?(u=t.charAt(fe),fe++):(u=R,0===Ue&&o(q)),u!==R)for(;u!==R;)i.push(u),$.test(t.charAt(fe))?(u=t.charAt(fe),fe++):(u=R,0===Ue&&o(q));else i=S;if(i!==R)if(58===t.charCodeAt(fe)?(u=Q,fe++):(u=R,0===Ue&&o(X)),u!==R){for(a=[],s=M();s!==R;)a.push(s),s=M();a!==R?(s=O(),s!==R?(he=e,r=tt(i,a),e=r):(fe=e,e=S)):(fe=e,e=S)}else fe=e,e=S;else fe=e,e=S}else fe=e,e=S;else fe=e,e=S;return e}function f(){var t,e,r,o;return t=fe,e=h(),e===R&&(e=W),e!==R?(r=p(),r===R&&(r=W),r!==R?(o=y(),o!==R?(he=t,e=et(e,r,o),t=e):(fe=t,t=S)):(fe=t,t=S)):(fe=t,t=S),t}function h(){var e,r,n,i,u,a,s,c;for(e=fe,r=[],n=C();n!==R;)r.push(n),n=C();if(r!==R){if(n=fe,t.substr(fe,2)===rt?(i=rt,fe+=2):(i=R,0===Ue&&o(ot)),i!==R){for(u=[],a=M();a!==R;)u.push(a),a=M();u!==R?(a=O(),a!==R?(he=n,i=nt(u),n=i):(fe=n,n=S)):(fe=n,n=S)}else fe=n,n=S;if(n===R&&(n=W),n!==R){for(i=[],u=C();u!==R;)i.push(u),u=C();if(i!==R){if(u=fe,t.substr(fe,2)===it?(a=it,fe+=2):(a=R,0===Ue&&o(ut)),a!==R){for(s=[],c=M();c!==R;)s.push(c),c=M();s!==R?(c=O(),c!==R?(he=u,a=at(s),u=a):(fe=u,u=S)):(fe=u,u=S)}else fe=u,u=S;u===R&&(u=W),u!==R?(he=e,r=st(n,u),e=r):(fe=e,e=S)}else fe=e,e=S}else fe=e,e=S}else fe=e,e=S;return e}function p(){var t,e,r,o,n,i,u;for(t=fe,e=[],r=C();r!==R;)e.push(r),r=C();if(e!==R)if(r=d(),r===R&&(r=v(),r===R&&(r=fe,o=ct,o!==R&&(he=r,o=lt()),r=o)),r!==R)if(o=A(),o!==R){for(n=[],i=C();i!==R;)n.push(i),i=C();n!==R?(i=E(),i!==R?(u=O(),u!==R?(he=t,e=ft(r,o,i),t=e):(fe=t,t=S)):(fe=t,t=S)):(fe=t,t=S)}else fe=t,t=S;else fe=t,t=S;else fe=t,t=S;return t}function d(){var e,r,n,i;if(e=fe,t.substr(fe,2)===ht?(r=ht,fe+=2):(r=R,0===Ue&&o(pt)),r!==R){for(n=[],i=T();i!==R;)n.push(i),i=T();n!==R?(i=O(),i!==R?(he=e,r=dt(n),e=r):(fe=e,e=S)):(fe=e,e=S)}else fe=e,e=S;return e}function v(){var t,e,r;if(t=fe,e=[],r=F(),r!==R)for(;r!==R;)e.push(r),r=F();else e=S;return e!==R&&(he=t,e=vt(e)),t=e}function F(){var e,r,n,i,u;if(e=fe,80===t.charCodeAt(fe)?(r=Ft,fe++):(r=R,0===Ue&&o(Ut)),r!==R)if(At.test(t.charAt(fe))?(n=t.charAt(fe),fe++):(n=R,0===Ue&&o(mt)),n!==R){if(i=[],u=U(),u!==R)for(;u!==R;)i.push(u),u=U();else i=S;i!==R?(u=O(),u!==R?(he=e,r=yt(i),e=r):(fe=e,e=S)):(fe=e,e=S)}else fe=e,e=S;else fe=e,e=S;return e}function U(){var e,r,n;return e=fe,r=E(),r!==R?(n=b(),n!==R?(he=e,r=Kt(r,n),e=r):(fe=e,e=S)):(fe=e,e=S),e===R&&(e=fe,t.substr(fe,3)===It?(r=It,fe+=3):(r=R,0===Ue&&o(gt)),r!==R&&(he=e,r=kt()),e=r),e}function A(){var t,e,r;for(t=fe,e=[],r=m();r!==R;)e.push(r),r=m();return e!==R&&(he=t,e=Et(e)),t=e}function m(){var e,r,n,i,u;if(e=fe,80===t.charCodeAt(fe)?(r=Ft,fe++):(r=R,0===Ue&&o(Ut)),r!==R)if(n=E(),n!==R){if(i=[],u=T(),u!==R)for(;u!==R;)i.push(u),u=T();else i=S;i!==R?(u=O(),u!==R?(he=e,r=Ct(n,i),e=r):(fe=e,e=S)):(fe=e,e=S)}else fe=e,e=S;else fe=e,e=S;return e}function y(){var t,e,r,o,n;if(t=fe,e=K(),e!==R){for(r=[],o=I();o!==R;)r.push(o),o=I();if(r!==R){for(o=[],n=C();n!==R;)o.push(n),n=C();o!==R?(he=t,e=xt(e,r),t=e):(fe=t,t=S)}else fe=t,t=S}else fe=t,t=S;return t}function K(){var t,e,r;for(t=fe,e=[],r=C();r!==R;)e.push(r),r=C();return e!==R&&(he=t,e=Bt(e)),t=e}function I(){var t,e,r,o,n;if(t=fe,e=g(),e===R&&(e=k()),e!==R)if(r=x(),r===R&&(r=W),r!==R){for(o=[],n=C();n!==R;)o.push(n),n=C();o!==R?(he=t,e=bt(e,r,o),t=e):(fe=t,t=S)}else fe=t,t=S;else fe=t,t=S;return t}function g(){var t,e,r,o,n,i;return t=fe,e=E(),e!==R?(r=B(),r!==R?(o=B(),o!==R?(n=b(),n!==R?(i=O(),i!==R?(he=t,e=Tt(r,o,n),t=e):(fe=t,t=S)):(fe=t,t=S)):(fe=t,t=S)):(fe=t,t=S)):(fe=t,t=S),t}function k(){var e,r,n,i;if(e=fe,37===t.charCodeAt(fe)?(r=Ot,fe++):(r=R,0===Ue&&o(Mt)),r!==R){if(n=[],Gt.test(t.charAt(fe))?(i=t.charAt(fe),fe++):(i=R,0===Ue&&o(Yt)),i!==R)for(;i!==R;)n.push(i),Gt.test(t.charAt(fe))?(i=t.charAt(fe),fe++):(i=R,0===Ue&&o(Yt));else n=S;n!==R?(i=O(),i!==R?(he=e,r=Ht(n),e=r):(fe=e,e=S)):(fe=e,e=S)}else fe=e,e=S;return e}function E(){var e,r;return e=fe,43===t.charCodeAt(fe)?(r=Dt,fe++):(r=R,0===Ue&&o(wt)),r!==R&&(he=e,r=Rt()),e=r,e===R&&(e=fe,45===t.charCodeAt(fe)?(r=Nt,fe++):(r=R,0===Ue&&o(Lt)),r!==R&&(he=e,r=St()),e=r),e}function C(){var e,r,n,i;if(e=fe,39===t.charCodeAt(fe)?(r=Wt,fe++):(r=R,0===Ue&&o(jt)),r!==R){for(n=[],i=M();i!==R;)n.push(i),i=M();n!==R?(i=O(),i!==R?(he=e,r=_t(n),e=r):(fe=e,e=S)):(fe=e,e=S)}else fe=e,e=S;return e}function x(){var e,r,n,i;if(e=fe,84===t.charCodeAt(fe)?(r=Pt,fe++):(r=R,0===Ue&&o(Vt)),r!==R){for(n=[],zt.test(t.charAt(fe))?(i=t.charAt(fe),fe++):(i=R,0===Ue&&o(Jt));i!==R;)n.push(i),zt.test(t.charAt(fe))?(i=t.charAt(fe),fe++):(i=R,0===Ue&&o(Jt));n!==R?(i=O(),i!==R?(he=e,r=Zt(n),e=r):(fe=e,e=S)):(fe=e,e=S)}else fe=e,e=S;return e}function B(){var e,r,n;return e=fe,zt.test(t.charAt(fe))?(r=t.charAt(fe),fe++):(r=R,0===Ue&&o(Jt)),r!==R?(zt.test(t.charAt(fe))?(n=t.charAt(fe),fe++):(n=R,0===Ue&&o(Jt)),n!==R?(he=e,r=$t(r,n),e=r):(fe=e,e=S)):(fe=e,e=S),e}function b(){var e,r,n;return e=fe,qt.test(t.charAt(fe))?(r=t.charAt(fe),fe++):(r=R,0===Ue&&o(Qt)),r!==R?(qt.test(t.charAt(fe))?(n=t.charAt(fe),fe++):(n=R,0===Ue&&o(Qt)),n!==R?(he=e,r=Xt(r,n),e=r):(fe=e,e=S)):(fe=e,e=S),e}function T(){var t,e,r;return t=fe,e=B(),e!==R?(r=b(),r!==R?(he=t,e=te(e,r),t=e):(fe=t,t=S)):(fe=t,t=S),t}function O(){var e,r,n;if(e=fe,13===t.charCodeAt(fe)?(r=ee,fe++):(r=R,0===Ue&&o(re)),r===R&&(r=W),r!==R?(10===t.charCodeAt(fe)?(n=oe,fe++):(n=R,0===Ue&&o(ne)),n!==R?(r=[r,n],e=r):(fe=e,e=S)):(fe=e,e=S),e===R){for(e=fe,r=[],32===t.charCodeAt(fe)?(n=ie,fe++):(n=R,0===Ue&&o(ue));n!==R;)r.push(n),32===t.charCodeAt(fe)?(n=ie,fe++):(n=R,0===Ue&&o(ue));r!==R?(44===t.charCodeAt(fe)?(n=ae,fe++):(n=R,0===Ue&&o(se)),n!==R?(r=[r,n],e=r):(fe=e,e=S)):(fe=e,e=S)}return e}function M(){var e;return ce.test(t.charAt(fe))?(e=t.charAt(fe),fe++):(e=R,0===Ue&&o(le)),e}function G(t){var e,r=t%60;return e=(t-r)/60,{m:e,s:r}}function Y(){return[[{color:1,kind:"KY"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"KY"}],[{color:1,kind:"KE"},{color:1,kind:"KA"},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{color:0,kind:"HI"},{color:0,kind:"KE"}],[{color:1,kind:"GI"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"GI"}],[{color:1,kind:"KI"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"KI"}],[{color:1,kind:"OU"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"OU"}],[{color:1,kind:"KI"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"KI"}],[{color:1,kind:"GI"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"GI"}],[{color:1,kind:"KE"},{color:1,kind:"HI"},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{color:0,kind:"KA"},{color:0,kind:"KE"}],[{color:1,kind:"KY"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"KY"}]]}function H(t){return{EVENT:"棋戦",SITE:"場所",START_TIME:"開始日時",END_TIME:"終了日時",TIME_LIMIT:"持ち時間"}[t]||t}var D,w=arguments.length>1?arguments[1]:{},R={},N={kifu:i},L=i,S=R,W=null,j=function(t,e,r){var o={header:t.header,initial:e,moves:r};return t&&t.players&&(t.players[0]&&(o.header["先手"]=t.players[0]),t.players[1]&&(o.header["後手"]=t.players[1])),o},_="V2.2",P={type:"literal",value:"V2.2",description:'"V2.2"'},V=function(t,e){return{players:t,header:e}},z=function(t){for(var e={},r=0;r<t.length;r++)e[H(t[r].k)]=t[r].v;return e},J="$",Z={type:"literal",value:"$",description:'"$"'},$=/^[^:]/,q={type:"class",value:"[^:]",description:"[^:]"},Q=":",X={type:"literal",value:":",description:'":"'},tt=function(t,e){return{k:t.join(""),v:e.join("")}},et=function(t,e,r){var o={header:{},initial:e,moves:r};return t&&(t[0]&&(o.header["先手"]=t[0]),t[1]&&(o.header["後手"]=t[1])),o},rt="N+",ot={type:"literal",value:"N+",description:'"N+"'},nt=function(t){return t},it="N-",ut={type:"literal",value:"N-",description:'"N-"'},at=function(t){return t},st=function(t,e){return[t?t.join(""):null,e?e.join(""):null]},ct="",lt=function(){return"NO"},ft=function(t,e,r){return"NO"==t?t=e:t.data.hands=e.data.hands,t.data.color=r,t},ht="PI",pt={type:"literal",value:"PI",description:'"PI"'},dt=function(t){for(var e={preset:"OTHER",data:{board:Y()}},r=0;r<t.length;r++)e.data.board[t[r].xy.x-1][t[r].xy.y-1]={};return e},vt=function(t){for(var e=[],r=0;9>r;r++){for(var o=[],n=0;9>n;n++)o.push(t[n][8-r]);e.push(o)}return{preset:"OTHER",data:{board:e}}},Ft="P",Ut={type:"literal",value:"P",description:'"P"'},At=/^[1-9]/,mt={type:"class",value:"[1-9]",description:"[1-9]"},yt=function(t){return t},Kt=function(t,e){return{color:t,kind:e}},It=" * ",gt={type:"literal",value:" * ",description:'" * "'},kt=function(){return{}},Et=function(t){for(var e=[],r=[{FU:0,KY:0,KE:0,GI:0,KI:0,KA:0,HI:0},{FU:0,KY:0,KE:0,GI:0,KI:0,KA:0,HI:0}],o={FU:18,KY:4,KE:4,GI:4,KI:4,KA:2,HI:2},n=0;9>n;n++){for(var i=[],u=0;9>u;u++)i.push({});e.push(i)}t:for(var n=0;n<t.length;n++)for(var u=0;u<t[n].pieces.length;u++){var a=t[n].pieces[u];if(0==a.xy.x){if("AL"==a.piece){r[t[n].teban]=o;break t}var s=r[t[n].teban];s[a.piece]++}else e[a.xy.x-1][a.xy.y-1]={color:t[n].teban,kind:a.piece};"OU"!=a.piece&&o[a.piece]--}return{preset:"OTHER",data:{board:e,hands:r}}},Ct=function(t,e){return{teban:t,pieces:e}},xt=function(t,e){return e.unshift(t),e},Bt=function(t){return t.length>0?{comments:t}:{}},bt=function(t,e,r){var o={};return r.length>0&&(o.comments=r),e&&(o.time=e),t.special?o.special=t.special:o.move=t,o},Tt=function(t,e,r){var o={to:e,piece:r};return 0!=t.x&&(o.from=t),o},Ot="%",Mt={type:"literal",value:"%",description:'"%"'},Gt=/^[\-+_A-Z]/,Yt={type:"class",value:"[\\-+_A-Z]",description:"[\\-+_A-Z]"},Ht=function(t){return{special:t.join("")}},Dt="+",wt={type:"literal",value:"+",description:'"+"'},Rt=function(){return 0},Nt="-",Lt={type:"literal",value:"-",description:'"-"'},St=function(){return 1},Wt="'",jt={type:"literal",value:"'",description:'"\'"'},_t=function(t){return t.join("")},Pt="T",Vt={type:"literal",value:"T",description:'"T"'},zt=/^[0-9]/,Jt={type:"class",value:"[0-9]",description:"[0-9]"},Zt=function(t){return{now:G(parseInt(t.join("")))}},$t=function(t,e){return{x:parseInt(t),y:parseInt(e)}},qt=/^[A-Z]/,Qt={type:"class",value:"[A-Z]",description:"[A-Z]"},Xt=function(t,e){return t+e},te=function(t,e){return{xy:t,piece:e}},ee="\r",re={type:"literal",value:"\r",description:'"\\r"'},oe="\n",ne={type:"literal",value:"\n",description:'"\\n"'},ie=" ",ue={type:"literal",value:" ",description:'" "'},ae=",",se={type:"literal",value:",",description:'","'},ce=/^[^\r\n]/,le={type:"class",value:"[^\\r\\n]",description:"[^\\r\\n]"},fe=0,he=0,pe=0,de={line:1,column:1,seenCR:!1},ve=0,Fe=[],Ue=0;if("startRule"in w){if(!(w.startRule in N))throw new Error("Can't start parsing from rule \""+w.startRule+'".');L=N[w.startRule]}if(D=L(),D!==R&&fe===t.length)return D;throw D!==R&&fe<t.length&&o({type:"end",description:"end of input"}),n(null,Fe,ve)}return t(e,Error),{SyntaxError:e,parse:r}}()},function(t,e,r){"use strict";/** @license
	 * JSON Kifu Format
	 * Copyright (c) 2014 na2hiro (https://github.com/na2hiro)
	 * This software is released under the MIT License.
	 * http://opensource.org/licenses/mit-license.php
	 */
var o=r(1),n=o.Color,i=o.Piece,u=o.Shogi,a=r(6),s=r(5),c=r(4),l=r(2),f=function(){function t(t){this.shogi=new u(t.initial||void 0),this.initialize(t)}return t.log=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];t.debug?console.log(e):t._log.push(e)},t.prototype.initialize=function(t){this.kifu=t,this.tesuu=0,this.forks=[{te:0,moves:this.kifu.moves}]},t.parse=function(e,r){if(r){var o=r.split("."),n=o[o.length-1].toLowerCase();switch(n){case"jkf":return t.parseJKF(e);case"kif":case"kifu":return t.parseKIF(e);case"ki2":case"ki2u":return t.parseKI2(e);case"csa":return t.parseCSA(e)}}try{return t.parseJKF(e)}catch(i){t.log("failed to parse as jkf",i)}try{return t.parseKIF(e)}catch(i){t.log("failed to parse as kif",i)}try{return t.parseKI2(e)}catch(i){t.log("failed to parse as ki2",i)}try{return t.parseCSA(e)}catch(i){t.log("failed to parse as csa",i)}throw"JKF, KIF, KI2, CSAいずれの形式でも失敗しました"},t.parseJKF=function(e){return t.log("parseJKF",e),new t(JSON.parse(e))},t.parseKIF=function(e){return t.log("parseKIF",e),new t(a.normalizeKIF(s.parse(t.addLastNewLine(e))))},t.parseKI2=function(e){return t.log("parseKI2",e),new t(a.normalizeKI2(c.parse(t.addLastNewLine(e))))},t.parseCSA=function(e){return t.log("parseCSA",e),new t(a.normalizeCSA(l.parse(t.addLastNewLine(e))))},t.addLastNewLine=function(t){return"\n"==t.substr(t.length-1)?t:t+"\n"},t.numToZen=function(t){return"０１２３４５６７８９"[t]},t.numToKan=function(t){return"〇一二三四五六七八九"[t]},t.kindToKan=function(t){return{FU:"歩",KY:"香",KE:"桂",GI:"銀",KI:"金",KA:"角",HI:"飛",OU:"玉",TO:"と",NY:"成香",NK:"成桂",NG:"成銀",UM:"馬",RY:"龍"}[t]},t.relativeToKan=function(t){return{L:"左",C:"直",R:"右",U:"上",M:"寄",D:"引",H:"打"}[t]},t.specialToKan=function(t){return{TORYO:"投了",CHUDAN:"中断",SENNICHITE:"千日手",TIME_UP:"時間切れ",ILLEGAL_MOVE:"反則負け","+ILLEGAL_ACTION":"後手反則負け","-ILLEGAL_ACTION":"先手反則負け",JISHOGI:"持将棋",KACHI:"勝ち宣言",HIKIWAKE:"引き分け宣言",MATTA:"待った",TSUMI:"詰",FUZUMI:"不詰",ERROR:"エラー"}[t]||t},t.moveToReadableKifu=function(e){if(e.special)return t.specialToKan(e.special);var r=e.move,o=r.color==n.Black?"☗":"☖";return o+=r.same?"同　":t.numToZen(r.to.x)+t.numToKan(r.to.y),o+=t.kindToKan(r.piece),r.relative&&(o+=r.relative.split("").map(t.relativeToKan).join("")),null!=r.promote&&(o+=r.promote?"成":"不成"),o},t.doMove=function(t,e){e&&(e.from?t.move(e.from.x,e.from.y,e.to.x,e.to.y,e.promote):t.drop(e.to.x,e.to.y,e.piece,"undefined"!=typeof e.color?e.color:void 0))},t.undoMove=function(t,e){e&&(e.from?t.unmove(e.from.x,e.from.y,e.to.x,e.to.y,e.promote,e.capture):t.undrop(e.to.x,e.to.y))},t.getState=function(e){return{color:e.turn,board:t.getBoardState(e),hands:t.getHandsState(e)}},t.prototype.forward=function(){if(!this.getMoveFormat(this.tesuu+1))return!1;this.tesuu++;var e=this.getMoveFormat(this.tesuu).move;return e?(t.log("forward",this.tesuu,e),this.doMove(e),!0):!0},t.prototype.backward=function(){var e=this;if(this.tesuu<=0)return!1;var r=this.getMoveFormat(this.tesuu).move;return t.log("backward",this.tesuu-1,r),this.undoMove(r),this.tesuu--,this.forks=this.forks.filter(function(t){return t.te<=e.tesuu}),!0},t.prototype["goto"]=function(t){var e=1e4;if(this.tesuu<t)for(;this.tesuu!=t&&this.forward()&&e-- >0;);else for(;this.tesuu!=t&&this.backward()&&e-- >0;);if(0==e)throw"tesuu overflows"},t.prototype.go=function(t){this["goto"](this.tesuu+t)},t.prototype.forkAndForward=function(t){var e=this.getMoveFormat(this.tesuu+1).forks;return!e||e.length<=t?!1:(this.forks.push({te:this.tesuu+1,moves:e[t]}),this.forward())},t.prototype.inputMove=function(e){if(this.getMoveFormat().special)throw"終了局面へ棋譜を追加することは出来ません";if(null!=e.from&&null==e.promote){var r=this.shogi.get(e.from.x,e.from.y);if(!i.isPromoted(r.kind)&&i.canPromote(r.kind)&&(a.canPromote(e.from,r.color)||a.canPromote(e.to,r.color)))return!1}var o=this.getMoveFormat(this.tesuu+1);if(o){if(o.move&&t.sameMoveMinimal(o.move,e))return this.forward(),!0;if(o.forks)for(var n=0;n<o.forks.length;n++){var u=o.forks[n][0];if(u&&u.move&&t.sameMoveMinimal(u.move,e))return this.forkAndForward(n),!0}}this.doMove(e);var s={move:e},c=this.tesuu<this.getMaxTesuu();if(c){var l=this.getMoveFormat(this.tesuu+1);l.forks||(l.forks=[]),l.forks.push([s])}else this.forks[this.forks.length-1].moves.push(s);return a.normalizeMinimal(this.kifu),this.undoMove(e),c?this.forkAndForward(l.forks.length-1):this.forward(),!0},t.prototype.getBoard=function(t,e){return this.shogi.get(t,e)},t.prototype.getComments=function(t){return void 0===t&&(t=this.tesuu),this.getMoveFormat(t).comments||[]},t.prototype.getMove=function(t){return void 0===t&&(t=this.tesuu),this.getMoveFormat(t).move},t.prototype.getReadableKifu=function(e){return void 0===e&&(e=this.tesuu),0==e?"開始局面":t.moveToReadableKifu(this.getMoveFormat(e))},t.prototype.getReadableForkKifu=function(e){return void 0===e&&(e=this.tesuu),this.getNextFork(e).map(function(e){return t.moveToReadableKifu(e[0])})},t.prototype.getMaxTesuu=function(){var t=this.forks[this.forks.length-1];return t.te+t.moves.length-1},t.prototype.toJKF=function(){return JSON.stringify(this.kifu)},t.prototype.getState=function(){return t.getState(this.shogi)},t.prototype.getReadableKifuState=function(){for(var t=[],e=0;e<=this.getMaxTesuu();e++)t.push({kifu:this.getReadableKifu(e),forks:this.getReadableForkKifu(e-1),comments:this.getComments(e)});return t},t.prototype.getMoveFormat=function(t){void 0===t&&(t=this.tesuu);for(var e=this.forks.length-1;e>=0;e--){var r=this.forks[e];if(r.te<=t)return r.moves[t-r.te]}throw"指定した手数が異常です"},t.prototype.getNextFork=function(t){void 0===t&&(t=this.tesuu);var e=this.getMoveFormat(t+1);return e&&e.forks?e.forks:[]},t.prototype.doMove=function(e){t.doMove(this.shogi,e)},t.prototype.undoMove=function(e){t.undoMove(this.shogi,e)},t.sameMoveMinimal=function(t,e){return t.to.x==e.to.x&&t.to.y==e.to.y&&(t.from?t.from.x==e.from.x&&t.from.y==e.from.y&&t.promote==e.promote:t.piece==e.piece)},t.getBoardState=function(t){for(var e=[],r=1;9>=r;r++){for(var o=[],n=1;9>=n;n++){var i=t.get(r,n);o.push(i?{color:i.color,kind:i.kind}:{})}e.push(o)}return e},t.getHandsState=function(t){return[t.getHandsSummary(n.Black),t.getHandsSummary(n.White)]},t.debug=!1,t._log=[],t}();t.exports=f},function(t,e){t.exports=function(){function t(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}function e(t,e,r,o,n,i){this.message=t,this.expected=e,this.found=r,this.offset=o,this.line=n,this.column=i,this.name="SyntaxError"}function r(t){function r(e){function r(e,r,o){var n,i;for(n=r;o>n;n++)i=t.charAt(n),"\n"===i?(e.seenCR||e.line++,e.column=1,e.seenCR=!1):"\r"===i||"\u2028"===i||"\u2029"===i?(e.line++,e.column=1,e.seenCR=!0):(e.column++,e.seenCR=!1)}return fr!==e&&(fr>e&&(fr=0,hr={line:1,column:1,seenCR:!1}),r(hr,fr,e),fr=e),hr}function o(t){pr>cr||(cr>pr&&(pr=cr,dr=[]),dr.push(t))}function n(o,n,i){function u(t){var e=1;for(t.sort(function(t,e){return t.description<e.description?-1:t.description>e.description?1:0});e<t.length;)t[e-1]===t[e]?t.splice(e,1):e++}function a(t,e){function r(t){function e(t){return t.charCodeAt(0).toString(16).toUpperCase()}return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(t){return"\\x0"+e(t)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(t){return"\\x"+e(t)}).replace(/[\u0180-\u0FFF]/g,function(t){return"\\u0"+e(t)}).replace(/[\u1080-\uFFFF]/g,function(t){return"\\u"+e(t)})}var o,n,i,u=new Array(t.length);for(i=0;i<t.length;i++)u[i]=t[i].description;return o=t.length>1?u.slice(0,-1).join(", ")+" or "+u[t.length-1]:u[0],n=e?'"'+r(e)+'"':"end of input","Expected "+o+" but "+n+" found."}var s=r(i),c=i<t.length?t.charAt(i):null;return null!==n&&u(n),new e(null!==o?o:a(n,c),n,c,i,s.line,s.column)}function i(){var t,e,r,o,n,i,s;for(t=cr,e=[],r=u();r!==W;)e.push(r),r=u();if(e!==W)if(r=a(),r===W&&(r=V),r!==W){for(o=[],n=u();n!==W;)o.push(n),n=u();if(o!==W)if(n=f(),n!==W){for(i=[],s=E();s!==W;)i.push(s),s=E();i!==W?(lr=t,e=z(e,r,o,n,i),t=e):(cr=t,t=P)}else cr=t,t=P;else cr=t,t=P}else cr=t,t=P;else cr=t,t=P;return t}function u(){var e,r,n,i,u,a;if(e=cr,r=[],J.test(t.charAt(cr))?(n=t.charAt(cr),cr++):(n=W,0===vr&&o(Z)),n!==W)for(;n!==W;)r.push(n),J.test(t.charAt(cr))?(n=t.charAt(cr),cr++):(n=W,0===vr&&o(Z));else r=P;if(r!==W)if(65306===t.charCodeAt(cr)?(n=$,cr++):(n=W,0===vr&&o(q)),n!==W){for(i=[],u=O();u!==W;)i.push(u),u=O();if(i!==W){if(u=[],a=x(),a!==W)for(;a!==W;)u.push(a),a=x();else u=P;u!==W?(lr=e,r=Q(r,i),e=r):(cr=e,e=P)}else cr=e,e=P}else cr=e,e=P;else cr=e,e=P;return e===W&&(e=cr,X.test(t.charAt(cr))?(r=t.charAt(cr),cr++):(r=W,0===vr&&o(tt)),r!==W?(t.substr(cr,2)===et?(n=et,cr+=2):(n=W,0===vr&&o(rt)),n!==W?(i=x(),i!==W?(lr=e,r=ot(r),e=r):(cr=e,e=P)):(cr=e,e=P)):(cr=e,e=P)),e}function a(){var e,r,n,i,u,a,c,l;if(e=cr,r=cr,32===t.charCodeAt(cr)?(n=nt,cr++):(n=W,0===vr&&o(it)),n!==W){for(i=[],u=O();u!==W;)i.push(u),u=O();i!==W?(u=x(),u!==W?(n=[n,i,u],r=n):(cr=r,r=P)):(cr=r,r=P)}else cr=r,r=P;if(r===W&&(r=V),r!==W){if(n=cr,43===t.charCodeAt(cr)?(i=ut,cr++):(i=W,0===vr&&o(at)),i!==W){for(u=[],a=O();a!==W;)u.push(a),a=O();u!==W?(a=x(),a!==W?(i=[i,u,a],n=i):(cr=n,n=P)):(cr=n,n=P)}else cr=n,n=P;if(n===W&&(n=V),n!==W){if(i=[],u=s(),u!==W)for(;u!==W;)i.push(u),u=s();else i=P;if(i!==W){if(u=cr,43===t.charCodeAt(cr)?(a=ut,cr++):(a=W,0===vr&&o(at)),a!==W){for(c=[],l=O();l!==W;)c.push(l),l=O();c!==W?(l=x(),l!==W?(a=[a,c,l],u=a):(cr=u,u=P)):(cr=u,u=P)}else cr=u,u=P;u===W&&(u=V),u!==W?(lr=e,r=st(i),e=r):(cr=e,e=P)}else cr=e,e=P}else cr=e,e=P}else cr=e,e=P;return e}function s(){var e,r,n,i,u,a;if(e=cr,124===t.charCodeAt(cr)?(r=ct,cr++):(r=W,0===vr&&o(lt)),r!==W){if(n=[],i=c(),i!==W)for(;i!==W;)n.push(i),i=c();else n=P;if(n!==W)if(124===t.charCodeAt(cr)?(i=ct,cr++):(i=W,0===vr&&o(lt)),i!==W){if(u=[],a=O(),a!==W)for(;a!==W;)u.push(a),a=O();else u=P;u!==W?(a=x(),a!==W?(lr=e,r=ft(n),e=r):(cr=e,e=P)):(cr=e,e=P)}else cr=e,e=P;else cr=e,e=P}else cr=e,e=P;return e}function c(){var e,r,n;return e=cr,r=l(),r!==W?(n=A(),n!==W?(lr=e,r=ht(r,n),e=r):(cr=e,e=P)):(cr=e,e=P),e===W&&(e=cr,t.substr(cr,2)===pt?(r=pt,cr+=2):(r=W,0===vr&&o(dt)),r!==W&&(lr=e,r=vt()),e=r),e}function l(){var e,r;return e=cr,32===t.charCodeAt(cr)?(r=nt,cr++):(r=W,0===vr&&o(it)),r===W&&(43===t.charCodeAt(cr)?(r=ut,cr++):(r=W,0===vr&&o(at)),r===W&&(94===t.charCodeAt(cr)?(r=Ft,cr++):(r=W,0===vr&&o(Ut)))),r!==W&&(lr=e,r=At()),e=r,e===W&&(e=cr,118===t.charCodeAt(cr)?(r=mt,cr++):(r=W,0===vr&&o(yt)),r===W&&(86===t.charCodeAt(cr)?(r=Kt,cr++):(r=W,0===vr&&o(It))),r!==W&&(lr=e,r=gt()),e=r),e}function f(){var t,e,r,o;if(t=cr,e=h(),e!==W){for(r=[],o=p();o!==W;)r.push(o),o=p();r!==W?(o=k(),o===W&&(o=V),o!==W?(lr=t,e=kt(e,r,o),t=e):(cr=t,t=P)):(cr=t,t=P)}else cr=t,t=P;return t}function h(){var t,e,r;for(t=cr,e=[],r=g();r!==W;)e.push(r),r=g();return e!==W?(r=d(),r===W&&(r=V),r!==W?(lr=t,e=Et(e),t=e):(cr=t,t=P)):(cr=t,t=P),t}function p(){var e,r,n,i,u,a;if(e=cr,r=v(),r!==W){for(n=[],i=g();i!==W;)n.push(i),i=g();if(n!==W)if(i=d(),i===W&&(i=V),i!==W){for(u=[],a=x(),a===W&&(32===t.charCodeAt(cr)?(a=nt,cr++):(a=W,0===vr&&o(it)));a!==W;)u.push(a),a=x(),a===W&&(32===t.charCodeAt(cr)?(a=nt,cr++):(a=W,0===vr&&o(it)));u!==W?(lr=e,r=Ct(r,n),e=r):(cr=e,e=P)}else cr=e,e=P;else cr=e,e=P}else cr=e,e=P;return e}function d(){var e,r,n,i;if(e=cr,38===t.charCodeAt(cr)?(r=xt,cr++):(r=W,0===vr&&o(Bt)),r!==W){for(n=[],i=O();i!==W;)n.push(i),i=O();n!==W?(i=x(),i!==W?(r=[r,n,i],e=r):(cr=e,e=P)):(cr=e,e=P)}else cr=e,e=P;return e}function v(){var e,r,n,i,u;if(e=cr,bt.test(t.charAt(cr))?(r=t.charAt(cr),cr++):(r=W,0===vr&&o(Tt)),r!==W)if(n=F(),n!==W){for(i=[],u=x(),u===W&&(32===t.charCodeAt(cr)?(u=nt,cr++):(u=W,0===vr&&o(it)));u!==W;)i.push(u),u=x(),u===W&&(32===t.charCodeAt(cr)?(u=nt,cr++):(u=W,0===vr&&o(it)));i!==W?(lr=e,r=Ot(n),e=r):(cr=e,e=P)}else cr=e,e=P;else cr=e,e=P;return e}function F(){var e,r,n,i,u,a,s;return e=cr,r=U(),r!==W?(n=A(),n!==W?(i=m(),i===W&&(i=V),i!==W?(u=y(),u===W&&(u=V),u!==W?(25104===t.charCodeAt(cr)?(a=Mt,cr++):(a=W,0===vr&&o(Gt)),a===W&&(t.substr(cr,2)===Yt?(a=Yt,cr+=2):(a=W,0===vr&&o(Ht))),a===W&&(a=V),a!==W?(25171===t.charCodeAt(cr)?(s=Dt,cr++):(s=W,0===vr&&o(wt)),s===W&&(s=V),s!==W?(lr=e,r=Rt(r,n,i,u,a,s),e=r):(cr=e,e=P)):(cr=e,e=P)):(cr=e,e=P)):(cr=e,e=P)):(cr=e,e=P)):(cr=e,e=P),e}function U(){var e,r,n;return e=cr,r=K(),r!==W?(n=I(),n!==W?(lr=e,r=Nt(r,n),e=r):(cr=e,e=P)):(cr=e,e=P),e===W&&(e=cr,21516===t.charCodeAt(cr)?(r=Lt,cr++):(r=W,0===vr&&o(St)),r!==W?(12288===t.charCodeAt(cr)?(n=Wt,cr++):(n=W,0===vr&&o(jt)),n===W&&(n=V),n!==W?(lr=e,r=_t(),e=r):(cr=e,e=P)):(cr=e,e=P)),e}function A(){var e,r,n;return e=cr,25104===t.charCodeAt(cr)?(r=Mt,cr++):(r=W,0===vr&&o(Gt)),r===W&&(r=V),r!==W?(Pt.test(t.charAt(cr))?(n=t.charAt(cr),cr++):(n=W,0===vr&&o(Vt)),n!==W?(lr=e,r=zt(r,n),e=r):(cr=e,e=P)):(cr=e,e=P),e}function m(){var e;return Jt.test(t.charAt(cr))?(e=t.charAt(cr),cr++):(e=W,0===vr&&o(Zt)),e}function y(){var e;return $t.test(t.charAt(cr))?(e=t.charAt(cr),cr++):(e=W,0===vr&&o(qt)),e}function K(){var e,r;return e=cr,Qt.test(t.charAt(cr))?(r=t.charAt(cr),cr++):(r=W,0===vr&&o(Xt)),r!==W&&(lr=e,r=te(r)),e=r}function I(){var e,r;return e=cr,ee.test(t.charAt(cr))?(r=t.charAt(cr),cr++):(r=W,0===vr&&o(re)),r!==W&&(lr=e,r=oe(r)),e=r}function g(){var e,r,n,i;if(e=cr,42===t.charCodeAt(cr)?(r=ne,cr++):(r=W,0===vr&&o(ie)),r!==W){for(n=[],i=O();i!==W;)n.push(i),i=O();n!==W?(i=x(),i!==W?(lr=e,r=ue(n),e=r):(cr=e,e=P)):(cr=e,e=P)}else cr=e,e=P;return e}function k(){var e,r,n,i,u,a,s,c,l,f,h,p;if(e=cr,t.substr(cr,2)===ae?(r=ae,cr+=2):(r=W,0===vr&&o(se)),r!==W){if(n=[],ce.test(t.charAt(cr))?(i=t.charAt(cr),cr++):(i=W,0===vr&&o(le)),i!==W)for(;i!==W;)n.push(i),ce.test(t.charAt(cr))?(i=t.charAt(cr),cr++):(i=W,0===vr&&o(le));else n=P;n!==W?(25163===t.charCodeAt(cr)?(i=fe,cr++):(i=W,0===vr&&o(he)),i!==W?(u=cr,12391===t.charCodeAt(cr)?(a=pe,cr++):(a=W,0===vr&&o(de)),a!==W?(s=C(),s!==W?(t.substr(cr,2)===ve?(c=ve,cr+=2):(c=W,0===vr&&o(Fe)),c!==W?(l=cr,t.substr(cr,2)===Ue?(f=Ue,cr+=2):(f=W,0===vr&&o(Ae)),f!==W&&(lr=l,f=me()),l=f,l===W&&(l=cr,t.substr(cr,2)===ye?(f=ye,cr+=2):(f=W,0===vr&&o(Ke)),f!==W?(h=cr,t.substr(cr,2)===Ue?(p=Ue,cr+=2):(p=W,0===vr&&o(Ae)),p!==W&&(lr=h,p=Ie()),h=p,h===W&&(h=cr,t.substr(cr,2)===ge?(p=ge,cr+=2):(p=W,0===vr&&o(ke)),p!==W&&(lr=h,p=Ee()),h=p),h!==W?(lr=l,f=Ce(h),l=f):(cr=l,l=P)):(cr=l,l=P)),l!==W?(lr=u,a=xe(s,l),u=a):(cr=u,u=P)):(cr=u,u=P)):(cr=u,u=P)):(cr=u,u=P),u===W&&(u=cr,t.substr(cr,8)===Be?(a=Be,cr+=8):(a=W,0===vr&&o(be)),a!==W?(s=C(),s!==W?(t.substr(cr,4)===Te?(c=Te,cr+=4):(c=W,0===vr&&o(Oe)),c!==W?(lr=u,a=Me(s),u=a):(cr=u,u=P)):(cr=u,u=P)):(cr=u,u=P),u===W&&(u=cr,t.substr(cr,3)===Ge?(a=Ge,cr+=3):(a=W,0===vr&&o(Ye)),a!==W&&(lr=u,a=He()),u=a,u===W&&(u=cr,t.substr(cr,4)===De?(a=De,cr+=4):(a=W,0===vr&&o(we)),a!==W&&(lr=u,a=Re()),u=a,u===W&&(u=cr,t.substr(cr,4)===Ne?(a=Ne,cr+=4):(a=W,0===vr&&o(Le)),a!==W&&(lr=u,a=Se()),u=a,u===W&&(u=cr,12391===t.charCodeAt(cr)?(a=pe,cr++):(a=W,0===vr&&o(de)),a===W&&(a=V),a!==W?(35440===t.charCodeAt(cr)?(s=We,cr++):(s=W,0===vr&&o(je)),s!==W?(12415===t.charCodeAt(cr)?(c=_e,cr++):(c=W,0===vr&&o(Pe)),c===W&&(c=V),c!==W?(lr=u,a=Ve(),u=a):(cr=u,u=P)):(cr=u,u=P)):(cr=u,u=P),u===W&&(u=cr,t.substr(cr,3)===ze?(a=ze,cr+=3):(a=W,0===vr&&o(Je)),a!==W&&(lr=u,a=Ze()),u=a)))))),u!==W?(a=x(),a!==W?(lr=e,r=Ce(u),e=r):(cr=e,e=P)):(cr=e,e=P)):(cr=e,e=P)):(cr=e,e=P)}else cr=e,e=P;return e}function E(){var e,r,n,i,u,a,s;if(e=cr,t.substr(cr,3)===$e?(r=$e,cr+=3):(r=W,0===vr&&o(qe)),r!==W){for(n=[],32===t.charCodeAt(cr)?(i=nt,cr++):(i=W,0===vr&&o(it));i!==W;)n.push(i),32===t.charCodeAt(cr)?(i=nt,cr++):(i=W,0===vr&&o(it));if(n!==W){if(i=[],ce.test(t.charAt(cr))?(u=t.charAt(cr),cr++):(u=W,0===vr&&o(le)),u!==W)for(;u!==W;)i.push(u),ce.test(t.charAt(cr))?(u=t.charAt(cr),cr++):(u=W,0===vr&&o(le));else i=P;i!==W?(25163===t.charCodeAt(cr)?(u=fe,cr++):(u=W,0===vr&&o(he)),u!==W?(a=x(),a!==W?(s=f(),s!==W?(lr=e,r=Qe(i,s),e=r):(cr=e,e=P)):(cr=e,e=P)):(cr=e,e=P)):(cr=e,e=P)}else cr=e,e=P}else cr=e,e=P;return e}function C(){var e;return X.test(t.charAt(cr))?(e=t.charAt(cr),cr++):(e=W,0===vr&&o(tt)),e}function x(){var t,e,r,o;if(t=cr,e=[],r=T(),r!==W)for(;r!==W;)e.push(r),r=T();else e=P;if(e!==W){for(r=[],o=B();o!==W;)r.push(o),o=B();r!==W?(e=[e,r],t=e):(cr=t,t=P)}else cr=t,t=P;return t}function B(){var e,r,n,i;if(e=cr,35===t.charCodeAt(cr)?(r=Xe,cr++):(r=W,0===vr&&o(tr)),r!==W){for(n=[],i=O();i!==W;)n.push(i),i=O();n!==W?(i=T(),i!==W?(r=[r,n,i],e=r):(cr=e,e=P)):(cr=e,e=P)}else cr=e,e=P;return e}function b(){var e;return 32===t.charCodeAt(cr)?(e=nt,cr++):(e=W,0===vr&&o(it)),e===W&&(9===t.charCodeAt(cr)?(e=er,cr++):(e=W,0===vr&&o(rr))),e}function T(){var e,r,n,i,u;for(e=cr,r=[],n=b();n!==W;)r.push(n),n=b();return r!==W?(10===t.charCodeAt(cr)?(n=or,cr++):(n=W,0===vr&&o(nr)),n===W&&(n=cr,13===t.charCodeAt(cr)?(i=ir,cr++):(i=W,0===vr&&o(ur)),i!==W?(10===t.charCodeAt(cr)?(u=or,cr++):(u=W,0===vr&&o(nr)),u===W&&(u=V),u!==W?(i=[i,u],n=i):(cr=n,n=P)):(cr=n,n=P)),n!==W?(r=[r,n],e=r):(cr=e,e=P)):(cr=e,e=P),e}function O(){var e;return ar.test(t.charAt(cr))?(e=t.charAt(cr),cr++):(e=W,0===vr&&o(sr)),e}function M(t){return"０１２３４５６７８９".indexOf(t)}function G(t){return"〇一二三四五六七八九".indexOf(t)}function Y(t){switch(t.length){case 1:return"〇一二三四五六七八九十".indexOf(t);case 2:return"〇一二三四五六七八九十".indexOf(t[1])+10;default:throw"21以上の数値に対応していません"}}function H(t){return"成"==t[0]?{"香":"NY","桂":"NK","銀":"NG"}[t[1]]:{"歩":"FU","香":"KY","桂":"KE","銀":"GI","金":"KI","角":"KA","飛":"HI","玉":"OU","王":"OU","と":"TO","杏":"NY","圭":"NK","全":"NG","馬":"UM","竜":"RY","龍":"RY"}[t]}function D(t){return{"左":"L","直":"C","右":"R"}[t]||""}function w(t){return{"上":"U","寄":"M","引":"D"}[t]||""}function R(t){return{"平手":"HIRATE","香落ち":"KY","右香落ち":"KY_R","角落ち":"KA","飛車落ち":"HI","飛香落ち":"HIKY","二枚落ち":"2","三枚落ち":"3","四枚落ち":"4","五枚落ち":"5","左五枚落ち":"5_L","六枚落ち":"6","八枚落ち":"8","十枚落ち":"10","その他":"OTHER"}[t.replace(/\s/g,"")]}function N(t){var e=t.replace(/　$/,"").split("　"),r={FU:0,KY:0,KE:0,GI:0,KI:0,KA:0,HI:0};if(""==t)return r;for(var o=0;o<e.length;o++)r[H(e[o][0])]=1==e[o].length?1:Y(e[o].slice(1));return r}var L,S=arguments.length>1?arguments[1]:{},W={},j={kifu:i},_=i,P=W,V=null,z=function(t,e,r,o,n){for(var i={header:{},moves:o},u=0;u<t.length;u++)i.header[t[u].k]=t[u].v;for(var u=0;u<r.length;u++)i.header[r[u].k]=r[u].v;if(e)i.initial=e;else if(i.header["手合割"]){var a=R(i.header["手合割"]);"OTHER"!=a&&(i.initial={preset:a})}i.initial&&i.initial.data&&(i.header["手番"]?(i.initial.data.color="下先".indexOf(i.header["手番"])>=0?0:1,delete i.header["手番"]):i.initial.data.color=0,i.initial.data.hands=[N(i.header["先手の持駒"]||i.header["下手の持駒"]),N(i.header["後手の持駒"]||i.header["上手の持駒"])],delete i.header["先手の持駒"],delete i.header["下手の持駒"],delete i.header["後手の持駒"],delete i.header["上手の持駒"]);for(var s=[{te:0,moves:o}],u=0;u<n.length;u++){for(var c=n[u],l=s.pop();l.te>c.te;)l=s.pop();var f=l.moves[c.te-l.te];f.forks=f.forks||[],f.forks.push(c.moves),s.push(l),s.push(c)}return i},J=/^[^\uFF1A\r\n]/,Z={type:"class",value:"[^\\uFF1A\\r\\n]",description:"[^\\uFF1A\\r\\n]"},$="：",q={type:"literal",value:"：",description:'"\\uFF1A"'},Q=function(t,e){return{k:t.join(""),v:e.join("")}},X=/^[\u5148\u5F8C\u4E0A\u4E0B]/,tt={type:"class",value:"[\\u5148\\u5F8C\\u4E0A\\u4E0B]",description:"[\\u5148\\u5F8C\\u4E0A\\u4E0B]"},et="手番",rt={type:"literal",value:"手番",description:'"\\u624B\\u756A"'},ot=function(t){return{k:"手番",v:t}},nt=" ",it={type:"literal",value:" ",description:'" "'},ut="+",at={type:"literal",value:"+",description:'"+"'},st=function(t){for(var e=[],r=0;9>r;r++){for(var o=[],n=0;9>n;n++)o.push(t[n][8-r]);e.push(o)}return{preset:"OTHER",data:{board:e}}},ct="|",lt={type:"literal",value:"|",description:'"|"'},ft=function(t){return t},ht=function(t,e){return{color:t,kind:e}},pt=" ・",dt={type:"literal",value:" ・",description:'" \\u30FB"'},vt=function(){return{}},Ft="^",Ut={type:"literal",value:"^",description:'"^"'},At=function(){return 0},mt="v",yt={type:"literal",value:"v",description:'"v"'},Kt="V",It={type:"literal",value:"V",description:'"V"'},gt=function(){return 1},kt=function(t,e,r){return e.unshift(t),r&&!e[e.length-1].special&&e.push({special:r}),e},Et=function(t){return 0==t.length?{}:{comments:t}},Ct=function(t,e){var r={move:t};return e.length>0&&(r.comments=e),r},xt="&",Bt={type:"literal",value:"&",description:'"&"'},bt=/^[\u25B2\u25B3]/,Tt={type:"class",value:"[\\u25B2\\u25B3]",description:"[\\u25B2\\u25B3]"},Ot=function(t){return t},Mt="成",Gt={type:"literal",value:"成",description:'"\\u6210"'},Yt="不成",Ht={type:"literal",value:"不成",description:'"\\u4E0D\\u6210"'},Dt="打",wt={type:"literal",value:"打",description:'"\\u6253"'},Rt=function(t,e,r,o,n,i){var u={piece:e};if(t.same?u.same=!0:u.to=t,n&&(u.promote="成"==n),i)u.relative="H";else{var a=D(r)+w(o);""!=a&&(u.relative=a)}return u},Nt=function(t,e){return{x:t,y:e}},Lt="同",St={type:"literal",value:"同",description:'"\\u540C"'},Wt="　",jt={type:"literal",value:"　",description:'"\\u3000"'},_t=function(){return{same:!0}},Pt=/^[\u6B69\u9999\u6842\u9280\u91D1\u89D2\u98DB\u738B\u7389\u3068\u674F\u572D\u5168\u99AC\u7ADC\u9F8D]/,Vt={type:"class",value:"[\\u6B69\\u9999\\u6842\\u9280\\u91D1\\u89D2\\u98DB\\u738B\\u7389\\u3068\\u674F\\u572D\\u5168\\u99AC\\u7ADC\\u9F8D]",description:"[\\u6B69\\u9999\\u6842\\u9280\\u91D1\\u89D2\\u98DB\\u738B\\u7389\\u3068\\u674F\\u572D\\u5168\\u99AC\\u7ADC\\u9F8D]"},zt=function(t,e){return H((t||"")+e)},Jt=/^[\u5DE6\u76F4\u53F3]/,Zt={type:"class",value:"[\\u5DE6\\u76F4\\u53F3]",description:"[\\u5DE6\\u76F4\\u53F3]"},$t=/^[\u4E0A\u5BC4\u5F15]/,qt={type:"class",value:"[\\u4E0A\\u5BC4\\u5F15]",description:"[\\u4E0A\\u5BC4\\u5F15]"},Qt=/^[\uFF11\uFF12\uFF13\uFF14\uFF15\uFF16\uFF17\uFF18\uFF19]/,Xt={type:"class",value:"[\\uFF11\\uFF12\\uFF13\\uFF14\\uFF15\\uFF16\\uFF17\\uFF18\\uFF19]",description:"[\\uFF11\\uFF12\\uFF13\\uFF14\\uFF15\\uFF16\\uFF17\\uFF18\\uFF19]"},te=function(t){return M(t)},ee=/^[\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D]/,re={type:"class",value:"[\\u4E00\\u4E8C\\u4E09\\u56DB\\u4E94\\u516D\\u4E03\\u516B\\u4E5D]",description:"[\\u4E00\\u4E8C\\u4E09\\u56DB\\u4E94\\u516D\\u4E03\\u516B\\u4E5D]"},oe=function(t){return G(t)},ne="*",ie={type:"literal",value:"*",description:'"*"'},ue=function(t){return t.join("")},ae="まで",se={type:"literal",value:"まで",description:'"\\u307E\\u3067"'},ce=/^[0-9]/,le={type:"class",value:"[0-9]",description:"[0-9]"},fe="手",he={type:"literal",value:"手",description:'"\\u624B"'},pe="で",de={type:"literal",value:"で",description:'"\\u3067"'},ve="手の",Fe={type:"literal",value:"手の",description:'"\\u624B\\u306E"'},Ue="勝ち",Ae={type:"literal",value:"勝ち",description:'"\\u52DD\\u3061"'},me=function(){return"TORYO"},ye="反則",Ke={type:"literal",value:"反則",description:'"\\u53CD\\u5247"'},Ie=function(){return"ILLEGAL_ACTION"},ge="負け",ke={type:"literal",value:"負け",description:'"\\u8CA0\\u3051"'},Ee=function(){return"ILLEGAL_MOVE"},Ce=function(t){return t},xe=function(t,e){return e},Be="で時間切れにより",be={type:"literal",value:"で時間切れにより",description:'"\\u3067\\u6642\\u9593\\u5207\\u308C\\u306B\\u3088\\u308A"'},Te="手の勝ち",Oe={type:"literal",value:"手の勝ち",description:'"\\u624B\\u306E\\u52DD\\u3061"'},Me=function(t){return"TIME_UP"},Ge="で中断",Ye={type:"literal",value:"で中断",description:'"\\u3067\\u4E2D\\u65AD"'},He=function(){return"CHUDAN"},De="で持将棋",we={type:"literal",value:"で持将棋",description:'"\\u3067\\u6301\\u5C06\\u68CB"'},Re=function(){return"JISHOGI"},Ne="で千日手",Le={type:"literal",value:"で千日手",description:'"\\u3067\\u5343\\u65E5\\u624B"'},Se=function(){return"SENNICHITE"},We="詰",je={type:"literal",value:"詰",description:'"\\u8A70"'},_e="み",Pe={type:"literal",value:"み",description:'"\\u307F"'},Ve=function(){return"TSUMI"},ze="で不詰",Je={type:"literal",value:"で不詰",description:'"\\u3067\\u4E0D\\u8A70"'},Ze=function(){return"FUZUMI"},$e="変化：",qe={type:"literal",value:"変化：",description:'"\\u5909\\u5316\\uFF1A"'},Qe=function(t,e){return{te:parseInt(t.join("")),moves:e.slice(1)}},Xe="#",tr={type:"literal",value:"#",description:'"#"'},er="	",rr={type:"literal",value:"	",description:'"\\t"'},or="\n",nr={type:"literal",value:"\n",description:'"\\n"'},ir="\r",ur={type:"literal",value:"\r",description:'"\\r"'},ar=/^[^\r\n]/,sr={type:"class",value:"[^\\r\\n]",description:"[^\\r\\n]"},cr=0,lr=0,fr=0,hr={line:1,column:1,seenCR:!1},pr=0,dr=[],vr=0;if("startRule"in S){if(!(S.startRule in j))throw new Error("Can't start parsing from rule \""+S.startRule+'".');_=j[S.startRule]}if(L=_(),L!==W&&cr===t.length)return L;throw L!==W&&cr<t.length&&o({type:"end",description:"end of input"}),n(null,dr,pr)}return t(e,Error),{SyntaxError:e,parse:r}}()},function(t,e){t.exports=function(){function t(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}function e(t,e,r,o,n,i){this.message=t,this.expected=e,this.found=r,this.offset=o,this.line=n,this.column=i,this.name="SyntaxError"}function r(t){function r(e){function r(e,r,o){var n,i;for(n=r;o>n;n++)i=t.charAt(n),"\n"===i?(e.seenCR||e.line++,e.column=1,e.seenCR=!1):"\r"===i||"\u2028"===i||"\u2029"===i?(e.line++,e.column=1,e.seenCR=!0):(e.column++,e.seenCR=!1)}return Tr!==e&&(Tr>e&&(Tr=0,Or={line:1,column:1,seenCR:!1}),r(Or,Tr,e),Tr=e),Or}function o(t){Mr>Br||(Br>Mr&&(Mr=Br,Gr=[]),Gr.push(t))}function n(o,n,i){function u(t){var e=1;for(t.sort(function(t,e){return t.description<e.description?-1:t.description>e.description?1:0});e<t.length;)t[e-1]===t[e]?t.splice(e,1):e++}function a(t,e){function r(t){function e(t){return t.charCodeAt(0).toString(16).toUpperCase()}return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(t){return"\\x0"+e(t)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(t){return"\\x"+e(t)}).replace(/[\u0180-\u0FFF]/g,function(t){return"\\u0"+e(t)}).replace(/[\u1080-\uFFFF]/g,function(t){return"\\u"+e(t)})}var o,n,i,u=new Array(t.length);for(i=0;i<t.length;i++)u[i]=t[i].description;return o=t.length>1?u.slice(0,-1).join(", ")+" or "+u[t.length-1]:u[0],n=e?'"'+r(e)+'"':"end of input","Expected "+o+" but "+n+" found."}var s=r(i),c=i<t.length?t.charAt(i):null;return null!==n&&u(n),new e(null!==o?o:a(n,c),n,c,i,s.line,s.column)}function i(){var t,e,r,o,n,i,a,c,l;for(t=Br,e=[],r=M();r!==V;)e.push(r),r=M();if(e!==V){for(r=[],o=u();o!==V;)r.push(o),o=u();if(r!==V)if(o=s(),o===V&&(o=$),o!==V){for(n=[],i=u();i!==V;)n.push(i),i=u();if(n!==V)if(i=h(),i===V&&(i=$),i!==V)if(a=p(),a!==V){for(c=[],l=T();l!==V;)c.push(l),l=T();c!==V?(l=O(),l===V&&(l=$),l!==V?(br=t,e=q(r,o,n,a,c),t=e):(Br=t,t=Z)):(Br=t,t=Z)}else Br=t,t=Z;else Br=t,t=Z;else Br=t,t=Z}else Br=t,t=Z;else Br=t,t=Z}else Br=t,t=Z;return t}function u(){var e,r,n,i,u;if(e=Br,r=[],Q.test(t.charAt(Br))?(n=t.charAt(Br),Br++):(n=V,0===Yr&&o(X)),n!==V)for(;n!==V;)r.push(n),Q.test(t.charAt(Br))?(n=t.charAt(Br),Br++):(n=V,0===Yr&&o(X));else r=Z;if(r!==V)if(65306===t.charCodeAt(Br)?(n=tt,Br++):(n=V,0===Yr&&o(et)),n!==V){for(i=[],u=H();u!==V;)i.push(u),u=H();i!==V?(u=O(),u!==V?(br=e,r=rt(r,i),e=r):(Br=e,e=Z)):(Br=e,e=Z)}else Br=e,e=Z;else Br=e,e=Z;return e===V&&(e=Br,r=a(),r!==V?(t.substr(Br,2)===ot?(n=ot,Br+=2):(n=V,0===Yr&&o(nt)),n!==V?(i=O(),i!==V?(br=e,r=it(r),e=r):(Br=e,e=Z)):(Br=e,e=Z)):(Br=e,e=Z),e===V&&(e=Br,t.substr(Br,4)===ut?(r=ut,Br+=4):(r=V,0===Yr&&o(at)),r!==V?(n=O(),n!==V?(br=e,r=st(),e=r):(Br=e,e=Z)):(Br=e,e=Z))),e}function a(){var e;return ct.test(t.charAt(Br))?(e=t.charAt(Br),Br++):(e=V,0===Yr&&o(lt)),e}function s(){var e,r,n,i,u,a,s,l;if(e=Br,r=Br,32===t.charCodeAt(Br)?(n=ft,Br++):(n=V,0===Yr&&o(ht)),n!==V){for(i=[],u=H();u!==V;)i.push(u),u=H();i!==V?(u=O(),u!==V?(n=[n,i,u],r=n):(Br=r,r=Z)):(Br=r,r=Z)}else Br=r,r=Z;if(r===V&&(r=$),r!==V){if(n=Br,43===t.charCodeAt(Br)?(i=pt,Br++):(i=V,0===Yr&&o(dt)),i!==V){for(u=[],a=H();a!==V;)u.push(a),a=H();u!==V?(a=O(),a!==V?(i=[i,u,a],n=i):(Br=n,n=Z)):(Br=n,n=Z)}else Br=n,n=Z;if(n===V&&(n=$),n!==V){if(i=[],u=c(),u!==V)for(;u!==V;)i.push(u),u=c();else i=Z;if(i!==V){if(u=Br,43===t.charCodeAt(Br)?(a=pt,Br++):(a=V,0===Yr&&o(dt)),a!==V){for(s=[],l=H();l!==V;)s.push(l),l=H();s!==V?(l=O(),l!==V?(a=[a,s,l],u=a):(Br=u,u=Z)):(Br=u,u=Z)}else Br=u,u=Z;u===V&&(u=$),u!==V?(br=e,r=vt(i),e=r):(Br=e,e=Z)}else Br=e,e=Z}else Br=e,e=Z}else Br=e,e=Z;return e}function c(){var e,r,n,i,u,a;if(e=Br,124===t.charCodeAt(Br)?(r=Ft,Br++):(r=V,0===Yr&&o(Ut)),r!==V){if(n=[],i=l(),i!==V)for(;i!==V;)n.push(i),i=l();else n=Z;if(n!==V)if(124===t.charCodeAt(Br)?(i=Ft,Br++):(i=V,0===Yr&&o(Ut)),i!==V){if(u=[],a=H(),a!==V)for(;a!==V;)u.push(a),a=H();else u=Z;u!==V?(a=O(),a!==V?(br=e,r=At(n),e=r):(Br=e,e=Z)):(Br=e,e=Z)}else Br=e,e=Z;else Br=e,e=Z}else Br=e,e=Z;return e}function l(){var e,r,n;return e=Br,r=f(),r!==V?(n=g(),n!==V?(br=e,r=mt(r,n),e=r):(Br=e,e=Z)):(Br=e,e=Z),e===V&&(e=Br,t.substr(Br,2)===yt?(r=yt,Br+=2):(r=V,0===Yr&&o(Kt)),r!==V&&(br=e,r=It()),e=r),e}function f(){var e,r;return e=Br,32===t.charCodeAt(Br)?(r=ft,Br++):(r=V,0===Yr&&o(ht)),r===V&&(43===t.charCodeAt(Br)?(r=pt,Br++):(r=V,0===Yr&&o(dt)),r===V&&(94===t.charCodeAt(Br)?(r=gt,Br++):(r=V,0===Yr&&o(kt)))),r!==V&&(br=e,r=Et()),e=r,e===V&&(e=Br,118===t.charCodeAt(Br)?(r=Ct,Br++):(r=V,0===Yr&&o(xt)),r===V&&(86===t.charCodeAt(Br)?(r=Bt,Br++):(r=V,0===Yr&&o(bt))),r!==V&&(br=e,r=Tt()),e=r),e}function h(){var e,r,n,i;return e=Br,t.substr(Br,10)===Ot?(r=Ot,Br+=10):(r=V,0===Yr&&o(Mt)),r!==V?(t.substr(Br,13)===Gt?(n=Gt,Br+=13):(n=V,0===Yr&&o(Yt)),n===V&&(n=$),n!==V?(i=O(),i!==V?(r=[r,n,i],e=r):(Br=e,e=Z)):(Br=e,e=Z)):(Br=e,e=Z),e}function p(){var t,e,r,o,n;if(t=Br,e=d(),e!==V)if(r=h(),r===V&&(r=$),r!==V){for(o=[],n=v();n!==V;)o.push(n),n=v();o!==V?(n=b(),n===V&&(n=$),n!==V?(br=t,e=Ht(e,o),t=e):(Br=t,t=Z)):(Br=t,t=Z)}else Br=t,t=Z;else Br=t,t=Z;return t}function d(){var t,e,r;for(t=Br,e=[],r=B();r!==V;)e.push(r),r=B();return e!==V?(r=F(),r===V&&(r=$),r!==V?(br=t,e=Dt(e),t=e):(Br=t,t=Z)):(Br=t,t=Z),t}function v(){var t,e,r,o;if(t=Br,e=U(),e!==V){for(r=[],o=B();o!==V;)r.push(o),o=B();r!==V?(o=F(),o===V&&(o=$),o!==V?(br=t,e=wt(e,r),t=e):(Br=t,t=Z)):(Br=t,t=Z)}else Br=t,t=Z;return t}function F(){var e,r,n,i;if(e=Br,38===t.charCodeAt(Br)?(r=Rt,Br++):(r=V,0===Yr&&o(Nt)),r!==V){for(n=[],i=H();i!==V;)n.push(i),i=H();n!==V?(i=O(),i!==V?(r=[r,n,i],e=r):(Br=e,e=Z)):(Br=e,e=Z)}else Br=e,e=Z;return e}function U(){var e,r,n,i,u,a,s,c,l;for(e=Br,r=[],32===t.charCodeAt(Br)?(n=ft,Br++):(n=V,0===Yr&&o(ht));n!==V;)r.push(n),32===t.charCodeAt(Br)?(n=ft,Br++):(n=V,0===Yr&&o(ht));if(r!==V)if(n=A(),n!==V){for(i=[],32===t.charCodeAt(Br)?(u=ft,Br++):(u=V,0===Yr&&o(ht));u!==V;)i.push(u),32===t.charCodeAt(Br)?(u=ft,Br++):(u=V,0===Yr&&o(ht));if(i!==V){if(u=Br,a=m(),a!==V?(s=k(),s!==V?(br=u,a=Lt(a,s),u=a):(Br=u,u=Z)):(Br=u,u=Z),u===V){for(u=Br,a=[],St.test(t.charAt(Br))?(s=t.charAt(Br),Br++):(s=V,0===Yr&&o(Wt));s!==V;)a.push(s),St.test(t.charAt(Br))?(s=t.charAt(Br),Br++):(s=V,0===Yr&&o(Wt));a!==V&&(br=u,a=jt(a)),u=a}if(u!==V){for(a=[],32===t.charCodeAt(Br)?(s=ft,Br++):(s=V,0===Yr&&o(ht));s!==V;)a.push(s),32===t.charCodeAt(Br)?(s=ft,Br++):(s=V,0===Yr&&o(ht));a!==V?(s=E(),s===V&&(s=$),s!==V?(43===t.charCodeAt(Br)?(c=pt,Br++):(c=V,0===Yr&&o(dt)),c===V&&(c=$),c!==V?(l=O(),l!==V?(br=e,r=_t(u,s),e=r):(Br=e,e=Z)):(Br=e,e=Z)):(Br=e,e=Z)):(Br=e,e=Z)}else Br=e,e=Z}else Br=e,e=Z}else Br=e,e=Z;else Br=e,e=Z;return e}function A(){var e,r;if(e=[],Pt.test(t.charAt(Br))?(r=t.charAt(Br),Br++):(r=V,0===Yr&&o(Vt)),r!==V)for(;r!==V;)e.push(r),Pt.test(t.charAt(Br))?(r=t.charAt(Br),Br++):(r=V,0===Yr&&o(Vt));else e=Z;return e}function m(){var e,r,n,i;return e=Br,r=y(),r!==V?(n=g(),n!==V?(25104===t.charCodeAt(Br)?(i=zt,Br++):(i=V,0===Yr&&o(Jt)),i===V&&(i=$),i!==V?(br=e,r=Zt(r,n,i),e=r):(Br=e,e=Z)):(Br=e,e=Z)):(Br=e,e=Z),e}function y(){var e,r,n;return e=Br,r=K(),r!==V?(n=I(),n!==V?(br=e,r=$t(r,n),e=r):(Br=e,e=Z)):(Br=e,e=Z),e===V&&(e=Br,t.substr(Br,2)===qt?(r=qt,Br+=2):(r=V,0===Yr&&o(Qt)),r!==V&&(br=e,r=st()),e=r),e}function K(){var e,r;return e=Br,Xt.test(t.charAt(Br))?(r=t.charAt(Br),Br++):(r=V,0===Yr&&o(te)),r!==V&&(br=e,r=ee(r)),e=r}function I(){
var e,r;return e=Br,re.test(t.charAt(Br))?(r=t.charAt(Br),Br++):(r=V,0===Yr&&o(oe)),r!==V&&(br=e,r=ne(r)),e=r}function g(){var e,r,n;return e=Br,25104===t.charCodeAt(Br)?(r=zt,Br++):(r=V,0===Yr&&o(Jt)),r===V&&(r=$),r!==V?(ie.test(t.charAt(Br))?(n=t.charAt(Br),Br++):(n=V,0===Yr&&o(ue)),n!==V?(br=e,r=ae(r,n),e=r):(Br=e,e=Z)):(Br=e,e=Z),e}function k(){var e,r,n,i,u;return e=Br,25171===t.charCodeAt(Br)?(r=se,Br++):(r=V,0===Yr&&o(ce)),r!==V&&(br=e,r=st()),e=r,e===V&&(e=Br,40===t.charCodeAt(Br)?(r=le,Br++):(r=V,0===Yr&&o(fe)),r!==V?(he.test(t.charAt(Br))?(n=t.charAt(Br),Br++):(n=V,0===Yr&&o(pe)),n!==V?(he.test(t.charAt(Br))?(i=t.charAt(Br),Br++):(i=V,0===Yr&&o(pe)),i!==V?(41===t.charCodeAt(Br)?(u=de,Br++):(u=V,0===Yr&&o(ve)),u!==V?(br=e,r=Fe(n,i),e=r):(Br=e,e=Z)):(Br=e,e=Z)):(Br=e,e=Z)):(Br=e,e=Z)),e}function E(){var e,r,n,i,u,a,s;if(e=Br,40===t.charCodeAt(Br)?(r=le,Br++):(r=V,0===Yr&&o(fe)),r!==V){for(n=[],32===t.charCodeAt(Br)?(i=ft,Br++):(i=V,0===Yr&&o(ht));i!==V;)n.push(i),32===t.charCodeAt(Br)?(i=ft,Br++):(i=V,0===Yr&&o(ht));n!==V?(i=x(),i!==V?(47===t.charCodeAt(Br)?(u=Ue,Br++):(u=V,0===Yr&&o(Ae)),u!==V?(a=C(),a!==V?(41===t.charCodeAt(Br)?(s=de,Br++):(s=V,0===Yr&&o(ve)),s!==V?(br=e,r=me(i,a),e=r):(Br=e,e=Z)):(Br=e,e=Z)):(Br=e,e=Z)):(Br=e,e=Z)):(Br=e,e=Z)}else Br=e,e=Z;return e}function C(){var e,r,n,i,u,a,s;if(e=Br,r=[],Pt.test(t.charAt(Br))?(n=t.charAt(Br),Br++):(n=V,0===Yr&&o(Vt)),n!==V)for(;n!==V;)r.push(n),Pt.test(t.charAt(Br))?(n=t.charAt(Br),Br++):(n=V,0===Yr&&o(Vt));else r=Z;if(r!==V)if(58===t.charCodeAt(Br)?(n=ye,Br++):(n=V,0===Yr&&o(Ke)),n!==V){if(i=[],Pt.test(t.charAt(Br))?(u=t.charAt(Br),Br++):(u=V,0===Yr&&o(Vt)),u!==V)for(;u!==V;)i.push(u),Pt.test(t.charAt(Br))?(u=t.charAt(Br),Br++):(u=V,0===Yr&&o(Vt));else i=Z;if(i!==V)if(58===t.charCodeAt(Br)?(u=ye,Br++):(u=V,0===Yr&&o(Ke)),u!==V){if(a=[],Pt.test(t.charAt(Br))?(s=t.charAt(Br),Br++):(s=V,0===Yr&&o(Vt)),s!==V)for(;s!==V;)a.push(s),Pt.test(t.charAt(Br))?(s=t.charAt(Br),Br++):(s=V,0===Yr&&o(Vt));else a=Z;a!==V?(br=e,r=Ie(r,i,a),e=r):(Br=e,e=Z)}else Br=e,e=Z;else Br=e,e=Z}else Br=e,e=Z;else Br=e,e=Z;return e}function x(){var e,r,n,i,u;if(e=Br,r=[],Pt.test(t.charAt(Br))?(n=t.charAt(Br),Br++):(n=V,0===Yr&&o(Vt)),n!==V)for(;n!==V;)r.push(n),Pt.test(t.charAt(Br))?(n=t.charAt(Br),Br++):(n=V,0===Yr&&o(Vt));else r=Z;if(r!==V)if(58===t.charCodeAt(Br)?(n=ye,Br++):(n=V,0===Yr&&o(Ke)),n!==V){if(i=[],Pt.test(t.charAt(Br))?(u=t.charAt(Br),Br++):(u=V,0===Yr&&o(Vt)),u!==V)for(;u!==V;)i.push(u),Pt.test(t.charAt(Br))?(u=t.charAt(Br),Br++):(u=V,0===Yr&&o(Vt));else i=Z;i!==V?(br=e,r=ge(r,i),e=r):(Br=e,e=Z)}else Br=e,e=Z;else Br=e,e=Z;return e}function B(){var e,r,n,i;if(e=Br,42===t.charCodeAt(Br)?(r=ke,Br++):(r=V,0===Yr&&o(Ee)),r!==V){for(n=[],i=H();i!==V;)n.push(i),i=H();n!==V?(i=O(),i!==V?(br=e,r=Ce(n),e=r):(Br=e,e=Z)):(Br=e,e=Z)}else Br=e,e=Z;if(e===V)if(e=Br,38===t.charCodeAt(Br)?(r=Rt,Br++):(r=V,0===Yr&&o(Nt)),r!==V){for(n=[],i=H();i!==V;)n.push(i),i=H();n!==V?(i=O(),i!==V?(br=e,r=xe(n),e=r):(Br=e,e=Z)):(Br=e,e=Z)}else Br=e,e=Z;return e}function b(){var e,r,n,i,u,s,c,l,f,h,p,d;if(e=Br,t.substr(Br,2)===Be?(r=Be,Br+=2):(r=V,0===Yr&&o(be)),r!==V){if(n=[],Pt.test(t.charAt(Br))?(i=t.charAt(Br),Br++):(i=V,0===Yr&&o(Vt)),i!==V)for(;i!==V;)n.push(i),Pt.test(t.charAt(Br))?(i=t.charAt(Br),Br++):(i=V,0===Yr&&o(Vt));else n=Z;n!==V?(25163===t.charCodeAt(Br)?(i=Te,Br++):(i=V,0===Yr&&o(Oe)),i!==V?(u=Br,12391===t.charCodeAt(Br)?(s=Me,Br++):(s=V,0===Yr&&o(Ge)),s!==V?(c=a(),c!==V?(t.substr(Br,2)===Ye?(l=Ye,Br+=2):(l=V,0===Yr&&o(He)),l!==V?(f=Br,t.substr(Br,2)===De?(h=De,Br+=2):(h=V,0===Yr&&o(we)),h!==V&&(br=f,h=Re()),f=h,f===V&&(f=Br,t.substr(Br,2)===Ne?(h=Ne,Br+=2):(h=V,0===Yr&&o(Le)),h!==V?(p=Br,t.substr(Br,2)===De?(d=De,Br+=2):(d=V,0===Yr&&o(we)),d!==V&&(br=p,d=Se()),p=d,p===V&&(p=Br,t.substr(Br,2)===We?(d=We,Br+=2):(d=V,0===Yr&&o(je)),d!==V&&(br=p,d=_e()),p=d),p!==V?(br=f,h=Pe(p),f=h):(Br=f,f=Z)):(Br=f,f=Z)),f!==V?(br=u,s=Ve(c,f),u=s):(Br=u,u=Z)):(Br=u,u=Z)):(Br=u,u=Z)):(Br=u,u=Z),u===V&&(u=Br,t.substr(Br,8)===ze?(s=ze,Br+=8):(s=V,0===Yr&&o(Je)),s!==V?(c=a(),c!==V?(t.substr(Br,4)===Ze?(l=Ze,Br+=4):(l=V,0===Yr&&o($e)),l!==V?(br=u,s=qe(c),u=s):(Br=u,u=Z)):(Br=u,u=Z)):(Br=u,u=Z),u===V&&(u=Br,t.substr(Br,3)===Qe?(s=Qe,Br+=3):(s=V,0===Yr&&o(Xe)),s!==V&&(br=u,s=tr()),u=s,u===V&&(u=Br,t.substr(Br,4)===er?(s=er,Br+=4):(s=V,0===Yr&&o(rr)),s!==V&&(br=u,s=or()),u=s,u===V&&(u=Br,t.substr(Br,4)===nr?(s=nr,Br+=4):(s=V,0===Yr&&o(ir)),s!==V&&(br=u,s=ur()),u=s,u===V&&(u=Br,12391===t.charCodeAt(Br)?(s=Me,Br++):(s=V,0===Yr&&o(Ge)),s===V&&(s=$),s!==V?(35440===t.charCodeAt(Br)?(c=ar,Br++):(c=V,0===Yr&&o(sr)),c!==V?(12415===t.charCodeAt(Br)?(l=cr,Br++):(l=V,0===Yr&&o(lr)),l===V&&(l=$),l!==V?(br=u,s=fr(),u=s):(Br=u,u=Z)):(Br=u,u=Z)):(Br=u,u=Z),u===V&&(u=Br,t.substr(Br,3)===hr?(s=hr,Br+=3):(s=V,0===Yr&&o(pr)),s!==V&&(br=u,s=dr()),u=s)))))),u!==V?(s=O(),s!==V?(br=e,r=Pe(u),e=r):(Br=e,e=Z)):(Br=e,e=Z)):(Br=e,e=Z)):(Br=e,e=Z)}else Br=e,e=Z;return e}function T(){var e,r,n,i,u,a,s;if(e=Br,t.substr(Br,3)===vr?(r=vr,Br+=3):(r=V,0===Yr&&o(Fr)),r!==V){for(n=[],32===t.charCodeAt(Br)?(i=ft,Br++):(i=V,0===Yr&&o(ht));i!==V;)n.push(i),32===t.charCodeAt(Br)?(i=ft,Br++):(i=V,0===Yr&&o(ht));if(n!==V){if(i=[],Pt.test(t.charAt(Br))?(u=t.charAt(Br),Br++):(u=V,0===Yr&&o(Vt)),u!==V)for(;u!==V;)i.push(u),Pt.test(t.charAt(Br))?(u=t.charAt(Br),Br++):(u=V,0===Yr&&o(Vt));else i=Z;i!==V?(25163===t.charCodeAt(Br)?(u=Te,Br++):(u=V,0===Yr&&o(Oe)),u!==V?(a=O(),a!==V?(s=p(),s!==V?(br=e,r=Ur(i,s),e=r):(Br=e,e=Z)):(Br=e,e=Z)):(Br=e,e=Z)):(Br=e,e=Z)}else Br=e,e=Z}else Br=e,e=Z;return e}function O(){var t,e,r,o;if(t=Br,e=[],r=Y(),r!==V)for(;r!==V;)e.push(r),r=Y();else e=Z;if(e!==V){for(r=[],o=M();o!==V;)r.push(o),o=M();r!==V?(e=[e,r],t=e):(Br=t,t=Z)}else Br=t,t=Z;return t}function M(){var e,r,n,i;if(e=Br,35===t.charCodeAt(Br)?(r=Ar,Br++):(r=V,0===Yr&&o(mr)),r!==V){for(n=[],i=H();i!==V;)n.push(i),i=H();n!==V?(i=Y(),i!==V?(r=[r,n,i],e=r):(Br=e,e=Z)):(Br=e,e=Z)}else Br=e,e=Z;return e}function G(){var e;return 32===t.charCodeAt(Br)?(e=ft,Br++):(e=V,0===Yr&&o(ht)),e===V&&(9===t.charCodeAt(Br)?(e=yr,Br++):(e=V,0===Yr&&o(Kr))),e}function Y(){var e,r,n,i,u;for(e=Br,r=[],n=G();n!==V;)r.push(n),n=G();return r!==V?(10===t.charCodeAt(Br)?(n=Ir,Br++):(n=V,0===Yr&&o(gr)),n===V&&(n=Br,13===t.charCodeAt(Br)?(i=kr,Br++):(i=V,0===Yr&&o(Er)),i!==V?(10===t.charCodeAt(Br)?(u=Ir,Br++):(u=V,0===Yr&&o(gr)),u===V&&(u=$),u!==V?(i=[i,u],n=i):(Br=n,n=Z)):(Br=n,n=Z)),n!==V?(r=[r,n],e=r):(Br=e,e=Z)):(Br=e,e=Z),e}function H(){var e;return Cr.test(t.charAt(Br))?(e=t.charAt(Br),Br++):(e=V,0===Yr&&o(xr)),e}function D(t){return parseInt(t.join(""),10)}function w(t){return"０１２３４５６７８９".indexOf(t)}function R(t){return"〇一二三四五六七八九".indexOf(t)}function N(t){switch(t.length){case 1:return"〇一二三四五六七八九十".indexOf(t);case 2:return"〇一二三四五六七八九十".indexOf(t[1])+10;default:throw"21以上の数値に対応していません"}}function L(t){return"成"==t[0]?{"香":"NY","桂":"NK","銀":"NG"}[t[1]]:{"歩":"FU","香":"KY","桂":"KE","銀":"GI","金":"KI","角":"KA","飛":"HI","玉":"OU","王":"OU","と":"TO","杏":"NY","圭":"NK","全":"NG","馬":"UM","竜":"RY","龍":"RY"}[t]}function S(t){return{"中断":"CHUDAN","投了":"TORYO","持将棋":"JISHOGI","千日手":"SENNICHITE","詰み":"TSUMI","不詰":"FUZUMI","切れ負け":"TIME_UP","反則勝ち":"ILLEGAL_ACTION","反則負け":"ILLEGAL_MOVE"}[t]}function W(t){return{"平手":"HIRATE","香落ち":"KY","右香落ち":"KY_R","角落ち":"KA","飛車落ち":"HI","飛香落ち":"HIKY","二枚落ち":"2","三枚落ち":"3","四枚落ち":"4","五枚落ち":"5","左五枚落ち":"5_L","六枚落ち":"6","八枚落ち":"8","十枚落ち":"10","その他":"OTHER"}[t.replace(/\s/g,"")]}function j(t){var e=t.split(/[ 　]/),r={FU:0,KY:0,KE:0,GI:0,KI:0,KA:0,HI:0};if(""==t)return r;for(var o=0;o<e.length;o++)""!=e[o]&&(r[L(e[o][0])]=1==e[o].length?1:N(e[o].slice(1)));return r}var _,P=arguments.length>1?arguments[1]:{},V={},z={kifu:i},J=i,Z=V,$=null,q=function(t,e,r,o,n){for(var i={header:{},moves:o},u=0;u<t.length;u++)t[u]&&(i.header[t[u].k]=t[u].v);for(var u=0;u<r.length;u++)r[u]&&(i.header[r[u].k]=r[u].v);if(e)i.initial=e;else if(i.header["手合割"]){var a=W(i.header["手合割"]);"OTHER"!=a&&(i.initial={preset:a})}i.initial&&i.initial.data&&(i.header["手番"]?(i.initial.data.color="下先".indexOf(i.header["手番"])>=0?0:1,delete i.header["手番"]):i.initial.data.color=0,i.initial.data.hands=[j(i.header["先手の持駒"]||i.header["下手の持駒"]),j(i.header["後手の持駒"]||i.header["上手の持駒"])],delete i.header["先手の持駒"],delete i.header["下手の持駒"],delete i.header["後手の持駒"],delete i.header["上手の持駒"]);for(var s=[{te:0,moves:o}],u=0;u<n.length;u++){for(var c=n[u],l=s.pop();l.te>c.te;)l=s.pop();var f=l.moves[c.te-l.te];f.forks=f.forks||[],f.forks.push(c.moves),s.push(l),s.push(c)}return i},Q=/^[^\uFF1A\r\n]/,X={type:"class",value:"[^\\uFF1A\\r\\n]",description:"[^\\uFF1A\\r\\n]"},tt="：",et={type:"literal",value:"：",description:'"\\uFF1A"'},rt=function(t,e){return{k:t.join(""),v:e.join("")}},ot="手番",nt={type:"literal",value:"手番",description:'"\\u624B\\u756A"'},it=function(t){return{k:"手番",v:t}},ut="盤面回転",at={type:"literal",value:"盤面回転",description:'"\\u76E4\\u9762\\u56DE\\u8EE2"'},st=function(){return null},ct=/^[\u5148\u5F8C\u4E0A\u4E0B]/,lt={type:"class",value:"[\\u5148\\u5F8C\\u4E0A\\u4E0B]",description:"[\\u5148\\u5F8C\\u4E0A\\u4E0B]"},ft=" ",ht={type:"literal",value:" ",description:'" "'},pt="+",dt={type:"literal",value:"+",description:'"+"'},vt=function(t){for(var e=[],r=0;9>r;r++){for(var o=[],n=0;9>n;n++)o.push(t[n][8-r]);e.push(o)}return{preset:"OTHER",data:{board:e}}},Ft="|",Ut={type:"literal",value:"|",description:'"|"'},At=function(t){return t},mt=function(t,e){return{color:t,kind:e}},yt=" ・",Kt={type:"literal",value:" ・",description:'" \\u30FB"'},It=function(){return{}},gt="^",kt={type:"literal",value:"^",description:'"^"'},Et=function(){return 0},Ct="v",xt={type:"literal",value:"v",description:'"v"'},Bt="V",bt={type:"literal",value:"V",description:'"V"'},Tt=function(){return 1},Ot="手数----指手--",Mt={type:"literal",value:"手数----指手--",description:'"\\u624B\\u6570----\\u6307\\u624B--"'},Gt="-------消費時間--",Yt={type:"literal",value:"-------消費時間--",description:'"-------\\u6D88\\u8CBB\\u6642\\u9593--"'},Ht=function(t,e){return e.unshift(t),e},Dt=function(t){return 0==t.length?{}:{comments:t}},wt=function(t,e){var r={};return e.length>0&&(r.comments=e),"object"==typeof t.move?r.move=t.move:r.special=S(t.move),t.time&&(r.time=t.time),r},Rt="&",Nt={type:"literal",value:"&",description:'"&"'},Lt=function(t,e){var r={piece:t.piece};return t.to?r.to=t.to:r.same=!0,t.promote&&(r.promote=!0),e&&(r.from=e),r},St=/^[^\r\n ]/,Wt={type:"class",value:"[^\\r\\n ]",description:"[^\\r\\n ]"},jt=function(t){return t.join("")},_t=function(t,e){return{move:t,time:e}},Pt=/^[0-9]/,Vt={type:"class",value:"[0-9]",description:"[0-9]"},zt="成",Jt={type:"literal",value:"成",description:'"\\u6210"'},Zt=function(t,e,r){return{to:t,piece:e,promote:!!r}},$t=function(t,e){return{x:t,y:e}},qt="同　",Qt={type:"literal",value:"同　",description:'"\\u540C\\u3000"'},Xt=/^[\uFF11\uFF12\uFF13\uFF14\uFF15\uFF16\uFF17\uFF18\uFF19]/,te={type:"class",value:"[\\uFF11\\uFF12\\uFF13\\uFF14\\uFF15\\uFF16\\uFF17\\uFF18\\uFF19]",description:"[\\uFF11\\uFF12\\uFF13\\uFF14\\uFF15\\uFF16\\uFF17\\uFF18\\uFF19]"},ee=function(t){return w(t)},re=/^[\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D]/,oe={type:"class",value:"[\\u4E00\\u4E8C\\u4E09\\u56DB\\u4E94\\u516D\\u4E03\\u516B\\u4E5D]",description:"[\\u4E00\\u4E8C\\u4E09\\u56DB\\u4E94\\u516D\\u4E03\\u516B\\u4E5D]"},ne=function(t){return R(t)},ie=/^[\u6B69\u9999\u6842\u9280\u91D1\u89D2\u98DB\u738B\u7389\u3068\u674F\u572D\u5168\u99AC\u7ADC\u9F8D]/,ue={type:"class",value:"[\\u6B69\\u9999\\u6842\\u9280\\u91D1\\u89D2\\u98DB\\u738B\\u7389\\u3068\\u674F\\u572D\\u5168\\u99AC\\u7ADC\\u9F8D]",description:"[\\u6B69\\u9999\\u6842\\u9280\\u91D1\\u89D2\\u98DB\\u738B\\u7389\\u3068\\u674F\\u572D\\u5168\\u99AC\\u7ADC\\u9F8D]"},ae=function(t,e){return L((t||"")+e)},se="打",ce={type:"literal",value:"打",description:'"\\u6253"'},le="(",fe={type:"literal",value:"(",description:'"("'},he=/^[1-9]/,pe={type:"class",value:"[1-9]",description:"[1-9]"},de=")",ve={type:"literal",value:")",description:'")"'},Fe=function(t,e){return{x:parseInt(t),y:parseInt(e)}},Ue="/",Ae={type:"literal",value:"/",description:'"/"'},me=function(t,e){return{now:t,total:e}},ye=":",Ke={type:"literal",value:":",description:'":"'},Ie=function(t,e,r){return{h:D(t),m:D(e),s:D(r)}},ge=function(t,e){return{m:D(t),s:D(e)}},ke="*",Ee={type:"literal",value:"*",description:'"*"'},Ce=function(t){return t.join("")},xe=function(t){return"&"+t.join("")},Be="まで",be={type:"literal",value:"まで",description:'"\\u307E\\u3067"'},Te="手",Oe={type:"literal",value:"手",description:'"\\u624B"'},Me="で",Ge={type:"literal",value:"で",description:'"\\u3067"'},Ye="手の",He={type:"literal",value:"手の",description:'"\\u624B\\u306E"'},De="勝ち",we={type:"literal",value:"勝ち",description:'"\\u52DD\\u3061"'},Re=function(){return"TORYO"},Ne="反則",Le={type:"literal",value:"反則",description:'"\\u53CD\\u5247"'},Se=function(){return"ILLEGAL_ACTION"},We="負け",je={type:"literal",value:"負け",description:'"\\u8CA0\\u3051"'},_e=function(){return"ILLEGAL_MOVE"},Pe=function(t){return t},Ve=function(t,e){return e},ze="で時間切れにより",Je={type:"literal",value:"で時間切れにより",description:'"\\u3067\\u6642\\u9593\\u5207\\u308C\\u306B\\u3088\\u308A"'},Ze="手の勝ち",$e={type:"literal",value:"手の勝ち",description:'"\\u624B\\u306E\\u52DD\\u3061"'},qe=function(t){return"TIME_UP"},Qe="で中断",Xe={type:"literal",value:"で中断",description:'"\\u3067\\u4E2D\\u65AD"'},tr=function(){return"CHUDAN"},er="で持将棋",rr={type:"literal",value:"で持将棋",description:'"\\u3067\\u6301\\u5C06\\u68CB"'},or=function(){return"JISHOGI"},nr="で千日手",ir={type:"literal",value:"で千日手",description:'"\\u3067\\u5343\\u65E5\\u624B"'},ur=function(){return"SENNICHITE"},ar="詰",sr={type:"literal",value:"詰",description:'"\\u8A70"'},cr="み",lr={type:"literal",value:"み",description:'"\\u307F"'},fr=function(){return"TSUMI"},hr="で不詰",pr={type:"literal",value:"で不詰",description:'"\\u3067\\u4E0D\\u8A70"'},dr=function(){return"FUZUMI"},vr="変化：",Fr={type:"literal",value:"変化：",description:'"\\u5909\\u5316\\uFF1A"'},Ur=function(t,e){return{te:parseInt(t.join("")),moves:e.slice(1)}},Ar="#",mr={type:"literal",value:"#",description:'"#"'},yr="	",Kr={type:"literal",value:"	",description:'"\\t"'},Ir="\n",gr={type:"literal",value:"\n",description:'"\\n"'},kr="\r",Er={type:"literal",value:"\r",description:'"\\r"'},Cr=/^[^\r\n]/,xr={type:"class",value:"[^\\r\\n]",description:"[^\\r\\n]"},Br=0,br=0,Tr=0,Or={line:1,column:1,seenCR:!1},Mr=0,Gr=[],Yr=0;if("startRule"in P){if(!(P.startRule in z))throw new Error("Can't start parsing from rule \""+P.startRule+'".');J=z[P.startRule]}if(_=J(),_!==V&&Br===t.length)return _;throw _!==V&&Br<t.length&&o({type:"end",description:"end of input"}),n(null,Gr,Mr)}return t(e,Error),{SyntaxError:e,parse:r}}()},function(t,e,r){"use strict";function o(t,e){return e==x.Black?t.y<=3:t.y>=7}function n(t){var e=new E(t.initial||void 0);return i(e,t.moves),t}function i(t,e,r){for(var n=0;n<e.length;n++){var u=0==n?r:e[n-1],a=e[n].move;if(a)if(a.color=t.turn,a.from){u&&u.move&&a.to.x==u.move.to.x&&a.to.y==u.move.to.y&&(a.same=!0),h(t,a),a.piece||(a.piece=t.get(a.from.x,a.from.y).kind),a.promote||C.isPromoted(a.piece)||!C.canPromote(a.piece)||(o(a.to,t.turn)||o(a.from,t.turn))&&(a.promote=!1),f(t,a);try{t.move(a.from.x,a.from.y,a.to.x,a.to.y,a.promote)}catch(s){throw n+"手目で失敗しました: "+s}}else t.getMovesTo(a.to.x,a.to.y,a.piece).length>0&&(a.relative="H"),t.drop(a.to.x,a.to.y,a.piece)}I(e,t);for(var n=e.length-1;n>=0;n--){var a=e[n].move;if(a&&(a.from?t.unmove(a.from.x,a.from.y,a.to.x,a.to.y,a.promote,a.capture):t.undrop(a.to.x,a.to.y)),u=1>=n?r:e[n-1],e[n].forks)for(var c=0;c<e[n].forks.length;c++)i(t,e[n].forks[c],u)}}function u(t){t.initial&&"HIRATE"==t.initial.preset&&t.initial.data&&(t.initial.preset="OTHER");var e=new E(t.initial||void 0);return a(e,t.moves),t}function a(t,e,r){for(var n=0;n<e.length;n++){var i=0==n?r:e[n-1],u=e[n].move;if(u)if(u.color=t.turn,u.from){u.same&&(u.to=i.move.to),h(t,u),u.promote||C.isPromoted(u.piece)||!C.canPromote(u.piece)||(o(u.to,t.turn)||o(u.from,t.turn))&&(u.promote=!1),f(t,u);try{t.move(u.from.x,u.from.y,u.to.x,u.to.y,u.promote)}catch(s){throw n+"手目で失敗しました: "+s}}else t.getMovesTo(u.to.x,u.to.y,u.piece).length>0&&(u.relative="H"),t.drop(u.to.x,u.to.y,u.piece)}I(e,t);for(var n=e.length-1;n>=0;n--){var u=e[n].move;if(u&&(u.from?t.unmove(u.from.x,u.from.y,u.to.x,u.to.y,u.promote,u.capture):t.undrop(u.to.x,u.to.y)),i=1>=n?r:e[n-1],e[n].forks)for(var c=0;c<e[n].forks.length;c++)a(t,e[n].forks[c],i)}}function s(t){var e=new E(t.initial||void 0);return c(e,t.moves),t}function c(t,e,r){for(var o=0;o<e.length;o++){var n=0==o?r:e[o-1],i=e[o].move;if(i){i.color=t.turn,i.same&&(i.to=n.move.to);var u=t.getMovesTo(i.to.x,i.to.y,i.piece);if("H"==i.relative||0==u.length);else if(1==u.length)i.from=u[0].from;else{var a=A(i.relative,t.turn,u);if(1!=a.length)throw"相対情報が不完全で複数の候補があります";i.from=a[0].from}if(i.from){h(t,i);try{t.move(i.from.x,i.from.y,i.to.x,i.to.y,i.promote)}catch(s){throw o+"手目で失敗しました: "+s}}else t.drop(i.to.x,i.to.y,i.piece)}}I(e,t);for(var o=e.length-1;o>=0;o--){var i=e[o].move;if(i&&(i.from?t.unmove(i.from.x,i.from.y,i.to.x,i.to.y,i.promote,i.capture):t.undrop(i.to.x,i.to.y),n=1>=o?r:e[o-1],e[o].forks))for(var l=0;l<e[o].forks.length;l++)c(t,e[o].forks[l],n)}}function l(t){y(t);for(var e=new E(t.initial||void 0),r=0;r<t.moves.length;r++){g(t.moves[r].time,r>=2?t.moves[r-2].time:void 0);var n=t.moves[r].move;if(n)if(n.color=e.turn,n.from){if(r>0&&t.moves[r-1].move&&t.moves[r-1].move.to.x==n.to.x&&t.moves[r-1].move.to.y==n.to.y&&(n.same=!0),h(e,n),C.isPromoted(n.piece)){var i=e.get(n.from.x,n.from.y);i.kind!=n.piece&&(n.piece=i.kind,n.promote=!0)}else C.canPromote(n.piece)&&(o(n.to,e.turn)||o(n.from,e.turn))&&(n.promote=!1);f(e,n);try{e.move(n.from.x,n.from.y,n.to.x,n.to.y,n.promote)}catch(u){throw r+"手目で失敗しました: "+u}}else e.getMovesTo(n.to.x,n.to.y,n.piece).length>0&&(n.relative="H"),e.drop(n.to.x,n.to.y,n.piece)}return t}function f(t,e){var r=t.getMovesTo(e.to.x,e.to.y,e.piece).map(function(e){return p(t.turn,v(e.to,e.from))});if(r.length>=2){var o=p(t.turn,v(e.to,e.from));e.relative=function(){return 1==r.filter(function(t){return t.y==o.y}).length?F(o.y):1==r.filter(function(t){return t.x==o.x}).length?U("UM"!=e.piece&&"RY"!=e.piece||0!=o.x?o.x:0==r.filter(function(t){return t.x<0}).length?-1:1):U(o.x)+F(o.y)}()}}function h(t,e){var r=t.get(e.to.x,e.to.y);r&&(e.capture=r.kind)}function p(t,e){return t==x.Black?e:{x:-e.x,y:-e.y}}function d(t,e){return t==e?0:t>e?1:-1}function v(t,e){return{x:d(t.x,e.x),y:d(t.y,e.y)}}function F(t){return 0==t?"M":t>0?"D":"U"}function U(t){return 0==t?"C":t>0?"R":"L"}function A(t,e,r){for(var o=[],n=0;n<r.length;n++)t.split("").every(function(t){return m(t,e,r[n])})&&o.push(r[n]);return o}function m(t,e,r){var o=p(e,{x:r.to.x-r.from.x,y:r.to.y-r.from.y});switch(t){case"U":return o.y<0;case"M":return 0==o.y;case"D":return o.y>0;case"L":return o.x<0;case"C":return 0==o.x;case"R":return o.x>0}}function y(t){if(t.initial&&"OTHER"==t.initial.preset){for(var e=["FU","KY","KE","GI","KI","KA","HI"],r=0;2>r;r++)for(var o=0;o<e.length;o++)if(0!=t.initial.data.hands[r][e[o]])return;for(var n=[[{color:x.White,kind:"KY"},{},{color:x.White,kind:"FU"},{},{},{},{color:x.Black,kind:"FU"},{},{color:x.Black,kind:"KY"}],[{color:x.White,kind:"KE"},{color:x.White,kind:"KA"},{color:x.White,kind:"FU"},{},{},{},{color:x.Black,kind:"FU"},{color:x.Black,kind:"HI"},{color:x.Black,kind:"KE"}],[{color:x.White,kind:"GI"},{},{color:x.White,kind:"FU"},{},{},{},{color:x.Black,kind:"FU"},{},{color:x.Black,kind:"GI"}],[{color:x.White,kind:"KI"},{},{color:x.White,kind:"FU"},{},{},{},{color:x.Black,kind:"FU"},{},{color:x.Black,kind:"KI"}],[{color:x.White,kind:"OU"},{},{color:x.White,kind:"FU"},{},{},{},{color:x.Black,kind:"FU"},{},{color:x.Black,kind:"OU"}],[{color:x.White,kind:"KI"},{},{color:x.White,kind:"FU"},{},{},{},{color:x.Black,kind:"FU"},{},{color:x.Black,kind:"KI"}],[{color:x.White,kind:"GI"},{},{color:x.White,kind:"FU"},{},{},{},{color:x.Black,kind:"FU"},{},{color:x.Black,kind:"GI"}],[{color:x.White,kind:"KE"},{color:x.White,kind:"HI"},{color:x.White,kind:"FU"},{},{},{},{color:x.Black,kind:"FU"},{color:x.Black,kind:"KA"},{color:x.Black,kind:"KE"}],[{color:x.White,kind:"KY"},{},{color:x.White,kind:"FU"},{},{},{},{color:x.Black,kind:"FU"},{},{color:x.Black,kind:"KY"}]],i=[],r=0;9>r;r++)for(var o=0;9>o;o++)K(t.initial.data.board[r][o],n[r][o])||i.push(""+(r+1)+(o+1));var u={};u[""]="HIRATE",u[11]="KY",u[91]="KY_R",u[22]="KA",u[82]="HI",u[1182]="HIKY",u[2282]="2",u[228291]="3",u[11228291]="4",u[1122818291]="5",u[1121228291]="5_L",u[112122818291]="6",u[0x3fbbf1cdec333]="8",u["11212231416171818291"]="10";var a=u[i.sort().join("")];"HIRATE"==a?t.initial.data.color==x.Black&&(t.initial.preset="HIRATE",delete t.initial.data):a&&t.initial.data.color==x.White&&(t.initial.preset=a,delete t.initial.data)}}function K(t,e){return"undefined"==typeof t.color&&"undefined"==typeof e.color||"undefined"!=typeof t.color&&"undefined"!=typeof e.color&&t.color==e.color&&t.kind==e.kind}function I(t,e){t.length>=1&&"ILLEGAL_ACTION"==t[t.length-1].special&&(t[t.length-1].special=(e.turn?"+":"-")+"ILLEGAL_ACTION")}function g(t,e){void 0===e&&(e={now:{m:0,s:0},total:{h:0,m:0,s:0}}),t&&(t.total={h:(t.now.h||0)+e.total.h,m:t.now.m+e.total.m,s:t.now.s+e.total.s},t.total.m+=Math.floor(t.total.s/60),t.total.s=t.total.s%60,t.total.h+=Math.floor(t.total.m/60),t.total.m=t.total.m%60)}/** @license
	 * JSON Kifu Format
	 * Copyright (c) 2014 na2hiro (https://github.com/na2hiro)
	 * This software is released under the MIT License.
	 * http://opensource.org/licenses/mit-license.php
	 */
var k=r(1),E=k.Shogi,C=k.Piece,x=k.Color;e.canPromote=o,e.normalizeMinimal=n,e.normalizeKIF=u,e.normalizeKI2=s,e.normalizeCSA=l}]);